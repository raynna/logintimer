{"version":3,"sources":["webpack://OCR/webpack/universalModuleDefinition","webpack://OCR/webpack/bootstrap","webpack://OCR/./index.ts","webpack://OCR/external {\"root\":\"A1lib\",\"commonjs\":\"@alt1/base\",\"commonjs2\":\"@alt1/base\",\"amd\":\"@alt1/base\"}"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;QCVA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;AClFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAuD;AA4BhD,IAAI,KAAK,GAAG;IAClB,eAAe,EAAE,KAAK;IACtB,SAAS,EAAE,KAAK;CAChB,CAAC;AAGK,IAAI,QAAQ,GAAG,EAAmC,CAAC;AAE1D;;;GAGG;AACI,SAAS,SAAS,CAAC,IAAoB;IAC7C,IAAI,OAAO,GAAG,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;IAC7B,IAAI,GAAG,GAAG,IAAI,oDAAS,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;IACtE,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,EAAE;QAC5C,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;QACpD,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;KACtB;IACD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAC3C,IAAI,EAAE,GAAG,CAAC,GAAG,OAAO,CAAC;QACrB,IAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QACxB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;YAClE,GAAG,CAAC,QAAQ,CAAC,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;YACpH,IAAI,IAAI,CAAC,MAAM,EAAE;gBAChB,GAAG,CAAC,QAAQ,CAAC,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;aACpF;SACD;KACD;IACD,GAAG,CAAC,IAAI,EAAE;AACX,CAAC;AAEM,SAAS,sBAAsB,CAAC,GAAc,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS;IACrF,IAAI,IAAI,GAAG,IAAI,oDAAS,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;IAChD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,EAAE;QAC5C,IAAI,GAAG,GAAG,cAAc,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACjF,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;QAChC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QACpC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QACpC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;KACvB;IACD,OAAO,IAAI,CAAC;AACb,CAAC;AAED;;;;;;GAMG;AACI,SAAS,cAAc,CAAC,GAAc,EAAE,KAAgB,EAAE,MAAe,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS;IAChH,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,IAAI,GAAG,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,EAAE;QAAE,MAAM,0BAA0B,CAAC;KAAE;IAC5G,IAAI,IAAI,GAAG,IAAI,oDAAS,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;IAChD,IAAI,UAAU,GAAG,CAAC,CAAC;IACnB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,EAAE;QAC5C,IAAI,GAAG,GAAG,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QACzI,IAAI,MAAM,EAAE;YACX,IAAI,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,EAAE;gBAAE,OAAO,CAAC,GAAG,CAAC,wBAAwB,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;aAAE;YAC/F,UAAU,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,iCAAgC;YACtE,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC;YAC3B,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC;YACpC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;SACpC;aAAM;YACN,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;YAChC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YACpC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;SACpC;QACD,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;KACvB;IACD,OAAO,IAAI,CAAC;AACb,CAAC;AAED;;;;;;;GAOG;AACI,SAAS,YAAY,CAAC,GAAc,EAAE,MAAe,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS;IAC5F,IAAI,IAAI,GAAG,IAAI,oDAAS,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;IAChD,IAAI,KAAK,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IACtB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,EAAE;QAC5C,IAAI,MAAM,EAAE;YACX,IAAI,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YAC9D,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YACnC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,GAAG,KAAK,GAAG,GAAG,CAAC;YACrC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;SACpC;aAAM;YACN,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YACnC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YACpC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;SACpC;QACD,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;KACvB;IACD,OAAO,IAAI,CAAC;AACb,CAAC;AAED;;;;;;GAMG;AACI,SAAS,QAAQ,CAAC,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,CAAS;IACzG,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IAClC,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;IAC3B,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;IAC3B,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;IAC3B,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC,CAAC;AACxD,CAAC;AAGD;;;GAGG;AACI,SAAS,aAAa,CAAC,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU;IACvI,4DAA4D;IAC5D,IAAI,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;IAC3B,IAAI,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;IAC3B,IAAI,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;IAE3B,yBAAyB;IACzB,IAAI,IAAI,GAAG,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC;IACxD,EAAE,IAAI,IAAI,CAAC;IACX,EAAE,IAAI,IAAI,CAAC;IACX,EAAE,IAAI,IAAI,CAAC;IAEX,OAAO,aAAa,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;AACtE,CAAC;AAED;;;GAGG;AACI,SAAS,cAAc,CAAC,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU;IACpG,IAAI,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;IAC3B,IAAI,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;IAC3B,IAAI,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;IAC3B,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IAClC,OAAO,CAAC,CAAC,GAAG,MAAM,GAAG,GAAG,CAAC,CAAC;AAC3B,CAAC;AAED;;GAEG;AACI,SAAS,aAAa,CAAC,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU,EAAE,EAAU;IAC3K,kBAAkB;IAClB,qBAAqB;IACrB,OAAO;IACP,kBAAkB;IAClB,4CAA4C;IAC5C,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;IAC1B,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;IAC1B,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;IAE1B,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;IAC1B,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;IAC1B,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;IAE1B,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;IAC1B,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;IAC1B,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;IAE1B,IAAI,GAAG,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;IAEnC,UAAU;IACV,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC;IACzC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC;IACzC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC;IAEzC,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AAClB,CAAC;AAED;;GAEG;AACI,SAAS,QAAQ,CAAC,MAAiB,EAAE,IAAoB,EAAE,GAAkB,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS;IAC/H,IAAI,CAAC,GAAG,CAAC,EAAE;QAAE,OAAO,IAAI,CAAC;KAAE;IAC3B,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE;QAAE,OAAO,IAAI,CAAC;KAAE;IACxC,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,EAAE;QAAE,OAAO,IAAI,CAAC;KAAE;IACvD,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,EAAE;QAAE,OAAO,IAAI,CAAC;KAAE;IAEtE,IAAI,IAAI,GAAG,IAAI,CAAC,gCAA+B;IAC/C,IAAI,QAAQ,GAAwB,IAAI,CAAC;IACzC,KAAK,IAAI,EAAE,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,EAAE;QAClC,KAAK,IAAI,EAAE,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,EAAE;YAClC,IAAI,GAAG,GAAG,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;YAC5D,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,CAAC,SAAS,GAAG,IAAI,EAAE;gBACxC,IAAI,GAAG,GAAG,CAAC,SAAS,CAAC;gBACrB,QAAQ,GAAG,GAAG,CAAC;aACf;SACD;KACD;IACD,OAAO,QAAQ,CAAC;AACjB,CAAC;AAED;;;GAGG;AACI,SAAS,YAAY,CAAC,MAAiB,EAAE,IAAoB,EAAE,IAAqB,EAAE,CAAS,EAAE,CAAS,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;IAChI,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE;QAAE,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC;QAAC,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;KAAE;IACzE,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE;QAAE,CAAC,GAAG,CAAC,CAAC;QAAC,CAAC,IAAI,CAAC,CAAC;KAAE;IAC/B,IAAI,GAAG,GAAgC,IAAI,CAAC;IAC5C,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;QACpB,+CAA+C;QAC/C,IAAI,MAAM,GAAG,gBAAgB,CAAC,MAAM,EAAE,IAAI,+CAAI,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;QAC/E,yCAAyC;QACzC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC,EAAE,EAAE;YAC/D,GAAG,GAAG,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;SACxD;KACD;SACI;QACJ,GAAG,GAAG,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;KAClD;IACD,IAAI,GAAG,IAAI,IAAI,EAAE;QAAE,OAAO,EAAE,SAAS,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,SAAS,EAAE,EAAE,EAAiC,CAAC;KAAE;IAClH,OAAO,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AAC/D,CAAC;AAEM,SAAS,gBAAgB,CAAC,GAAc,EAAE,IAAc,EAAE,MAAuB;IACvF,IAAI,QAAQ,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IACvD,IAAI,IAAI,CAAC,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,IAAI,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,EAAE;QAAE,OAAO,QAAQ,CAAC;KAAE;IAC1H,IAAI,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;IACpB,IAAI,IAAI,GAAG,EAAE,CAAC;IACd,KAAK,IAAI,MAAM,IAAI,QAAQ,EAAE;QAC5B,IAAI,KAAK,GAAG,CAAC,CAAC;QACd,IAAI,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC;QACrB,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACnD,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,EAAE,CAAC,EAAE,EAAE;gBAClD,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC;gBAClC,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;gBACrG,IAAI,CAAC,GAAG,IAAI,EAAE;oBAAE,KAAK,IAAI,IAAI,GAAG,CAAC,CAAC;iBAAE;aACpC;SACD;QACD,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;KACrB;IACD,OAAO,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;AACnD,CAAC;AAGD,SAAS,OAAO,CAAC,CAAS,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS,EAAE,CAAS;IAChF,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;IACzC,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;IAEzC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;IACpC,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IAE9C,IAAI,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;IACtC,IAAI,EAAE,GAAG,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC;IAErB,IAAI,EAAE,GAAG,GAAG,EAAC,sBAAsB;KACnC;QACC,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,GAAG,GAAG,CAAC,CAAC;QAChC,EAAE,GAAG,GAAG,CAAC;KACT;IAED,OAAO,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;AACjB,CAAC;AAGM,SAAS,YAAY,CAAC,GAAc,EAAE,IAAc,EAAE,MAAuB;IACnF,IAAI,SAAS,GAAG,CAAC,GAAG,CAAC;IACrB,IAAI,IAAI,GAAyB,IAAI,CAAC;IACtC,IAAI,EAAE,GAAG,GAAG,CAAC;IACb,IAAI,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;IACpB,KAAK,IAAI,GAAG,IAAI,MAAM,EAAE;QACvB,IAAI,KAAK,GAAG,GAAG,CAAC;QAChB,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACnD,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,EAAE,CAAC,EAAE,EAAE;gBAClD,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,GAAG,CAAC,KAAK,EAAE;oBAAE,SAAS;iBAAE;gBAC9C,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,GAAG,CAAC,KAAK,EAAE;oBAAE,SAAS;iBAAE;gBAC9C,IAAI,EAAE,GAAG,GAAG,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC/B,IAAI,EAAE,GAAG,GAAG,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;gBACvC,IAAI,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;gBACvF,IAAI,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;gBACvF,yCAAyC;gBACzC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,GAAG,GAAG,MAAM,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,GAAG,GAAG,CAAC,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;gBAC5F,KAAK,IAAI,CAAC,CAAC;aACX;SACD;QACD,IAAI,KAAK,GAAG,SAAS,EAAE;YAAE,EAAE,GAAG,SAAS,CAAC;YAAC,SAAS,GAAG,KAAK,CAAC;YAAC,IAAI,GAAG,GAAG,CAAC;SAAE;aACpE,IAAI,KAAK,GAAG,EAAE,EAAE;YAAE,EAAE,GAAG,KAAK,CAAC;SAAE;KACpC;IACD,oEAAoE;IACpE,wCAAwC;IACxC,OAAO,IAAI,CAAC;AACb,CAAC;AAED;;GAEG;AACI,SAAS,QAAQ,CAAC,MAAiB,EAAE,IAAoB,EAAE,MAAuC,EAAE,CAAS,EAAE,CAAS,EAAE,OAAgB,EAAE,QAAQ,GAAG,KAAK;IAClK,IAAI,OAAO,MAAM,CAAC,CAAC,CAAC,IAAI,QAAQ,IAAI,MAAM,CAAC,MAAM,IAAI,CAAC,EAAE;QAAE,MAAM,GAAG,MAAM,CAAC,CAAC,CAAkB,CAAC;KAAE;IAChG,IAAI,QAAQ,GAAG,OAAO,MAAM,CAAC,CAAC,CAAC,IAAI,QAAQ,CAAC;IAC5C,IAAI,SAAS,GAAoB,QAAQ,CAAC,CAAC,CAAC,MAAyB,CAAC,CAAC,CAAC,CAAC,MAAuB,CAAC,CAAC;IAElG,IAAI,WAAW,GAAG,UAAU,EAAU,EAAE,EAAU,EAAE,QAAiB;QACpE,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,CAAC;QACrC,IAAI,QAAQ,EAAE;YAAE,EAAE,IAAI,CAAC,CAAC;SAAE;QAC1B,EAAE,IAAI,IAAI,CAAC,KAAK,CAAC;QACjB,OAAO,YAAY,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,EAAE,SAAS,CAAC,CAAC;IACzF,CAAC;IAED,IAAI,SAAS,GAAmB,EAAE,CAAC;IACnC,IAAI,EAAE,GAAG,CAAC,CAAC;IACX,IAAI,EAAE,GAAG,CAAC,CAAC;IACX,IAAI,SAAS,GAAG,CAAC,OAAO,IAAI,CAAC,SAAS,IAAI,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAEzE,IAAI,QAAQ,GAAG,EAAE,CAAC;IAClB,IAAI,cAAc,GAAG,KAAK,CAAC;IAC3B,IAAI,OAAO,GAAyB,IAAI,CAAC;IACzC,IAAI,OAAO,GAAG,CAAC,OAAgB,EAAE,EAAE;QAClC,IAAI,CAAC,QAAQ,EAAE;YAAE,OAAO;SAAE;QAC1B,IAAI,IAAI,GAAiB;YACxB,IAAI,EAAE,QAAQ;YACd,KAAK,EAAE,OAAQ;YACf,KAAK,EAAE,CAAC;YACR,MAAM,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,SAAS,CAAC;YAC/C,IAAI,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,WAAW,CAAC;SAC7C,CAAC;QACF,IAAI,OAAO,EAAE;YAAE,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SAAE;aACjC;YAAE,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;SAAE;QACjC,QAAQ,GAAG,EAAE,CAAC;QACd,WAAW,GAAG,EAAE,CAAC;QACjB,cAAc,GAAG,KAAK,CAAC;IACxB,CAAC;IAED,KAAK,IAAI,UAAU,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE;QACrC,WAAW;QACX,IAAI,UAAU,IAAI,CAAC,OAAO,EAAE;YAAE,SAAS;SAAE;QACzC,IAAI,CAAC,UAAU,IAAI,CAAC,QAAQ,EAAE;YAAE,SAAS;SAAE;QAE3C,IAAI,EAAE,GAAG,CAAC,CAAC;QACX,IAAI,WAAW,GAAG,EAAE,CAAC;QACrB,IAAI,SAAS,GAAG,EAAE,CAAC;QACnB,IAAI,WAAW,GAAG,CAAC,CAAC;QACpB,IAAI,UAAU,GAAG,KAAK,CAAC;QACvB,IAAI,GAAG,GAAG,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAuB,CAAC;QAEpD,OAAO,IAAI,EAAE;YACZ,GAAG,GAAG,GAAG,IAAI,WAAW,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC;YACjD,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;YACnF,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,EAAE;gBAC/B,IAAI,WAAW,GAAG,SAAS,EAAE;oBAC5B,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC;oBAC9C,WAAW,EAAE,CAAC;oBACd,SAAS;iBACT;gBACD,IAAI,QAAQ,IAAI,CAAC,UAAU,IAAI,cAAc,EAAE;oBAC9C,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC;oBAC5D,WAAW,GAAG,CAAC,CAAC;oBAChB,GAAG,GAAG,IAAI,CAAC;oBACX,UAAU,GAAG,IAAI,CAAC;oBAClB,SAAS;iBACT;gBACD,IAAI,UAAU,EAAE;oBAAE,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;iBAAE;qBAC7C;oBAAE,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;iBAAE;gBACvC,MAAM;aACN;iBAAM;gBACN,IAAI,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,OAAO,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,IAAI,OAAO,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,EAAE;oBACtF,OAAO,CAAC,UAAU,CAAC,CAAC;iBACpB;gBACD,IAAI,MAAM,GAAG,EAAE,CAAC;gBAChB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,EAAE,CAAC,EAAE,EAAE;oBAAE,MAAM,IAAI,GAAG,CAAC;iBAAE;gBACxD,IAAI,UAAU,EAAE;oBAAE,QAAQ,IAAI,MAAM,GAAG,GAAG,CAAC,GAAG,CAAC;iBAAE;qBAC5C;oBAAE,QAAQ,GAAG,GAAG,CAAC,GAAG,GAAG,MAAM,GAAG,QAAQ,CAAC;iBAAE;gBAChD,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,SAAS,EAAE;oBAAE,cAAc,GAAG,IAAI,CAAC;iBAAE;gBACvD,WAAW,GAAG,CAAC,CAAC;gBAChB,UAAU,GAAG,KAAK,CAAC;gBACnB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC;gBACjD,SAAS,GAAG,EAAE,CAAC;gBACf,OAAO,GAAG,GAAG,CAAC;aACd;SACD;QACD,IAAI,OAAO,IAAI,cAAc,EAAE;YAAE,OAAO,CAAC,UAAU,CAAC,CAAC;SAAE;KACvD;IAED,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;IAEzC,OAAO;QACN,SAAS,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE;QACjD,IAAI,EAAE,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC;QACzC,SAAS;KACT,CAAC;AACH,CAAC;AAED;;;;GAIG;AACI,SAAS,sBAAsB,CAAC,MAAiB,EAAE,IAAoB,EAAE,IAAqB,EAAE,CAAS,EAAE,CAAS,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;IAC1I,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE;QAAE,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC;QAAC,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;KAAE;IACzE,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE;QAAE,CAAC,GAAG,CAAC,CAAC;QAAC,CAAC,IAAI,CAAC,CAAC;KAAE;IAC/B,IAAI,WAAW,GAAwB,IAAI,CAAC;IAC5C,IAAI,MAAM,GAAG,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,MAAM,EAAE,IAAI,+CAAI,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;IACnI,yCAAyC;IACzC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,IAAI,WAAW,IAAI,IAAI,EAAE,CAAC,EAAE,EAAE;QACvE,KAAK,IAAI,EAAE,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,EAAE,EAAE;YACvC,IAAI,IAAI,GAAG,IAAI,CAAC,gCAA+B;YAC/C,IAAI,QAAQ,GAAwB,IAAI,CAAC;YACzC,KAAK,IAAI,EAAE,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,EAAE;gBAClC,IAAI,GAAG,GAAG,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;gBACrE,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,CAAC,SAAS,GAAG,IAAI,EAAE;oBACxC,IAAI,GAAG,GAAG,CAAC,SAAS,CAAC;oBACrB,QAAQ,GAAG,GAAG,CAAC;iBACf;aACD;YACD,IAAI,QAAQ,EAAE;gBACb,WAAW,GAAG,QAAQ,CAAC;gBACvB,MAAM;aACN;SACD;KACD;IACD,IAAI,WAAW,IAAI,IAAI,EAAE;QAAE,OAAO,EAAE,IAAI,EAAE,EAAE,EAAE,SAAS,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;KAAE;IAC5E,OAAO,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,WAAW,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;AAChF,CAAC;AACD;;;;;GAKG;AACI,SAAS,QAAQ,CAAC,MAAiB,EAAE,IAAoB,EAAE,GAAkB,EAAE,CAAS,EAAE,CAAS,EAAE,SAAkB,EAAE,cAAwB;IACvJ,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC;IAChB,IAAI,MAAM,GAAG,CAAC,CAAC;IACf,IAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC;IACxB,IAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;IACzB,IAAI,QAAQ,GAAuB,IAAI,CAAC;IACxC,IAAI,QAAQ,GAAqB,IAAI,CAAC;IACtC,IAAI,KAAK,CAAC,SAAS,EAAE;QACpB,IAAI,IAAI,GAAG,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;QACnD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;YAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;SAAE;QAC7C,QAAQ,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC;KAC1B;IAED,oEAAoE;IACpE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE;QAAE,OAAO,IAAI,CAAC;KAAE;IAC/D,IAAI,CAAC,SAAS,EAAE;QACf,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,EAAE;YAAE,OAAO,IAAI,CAAC;SAAE;KAC5D;SACI;QACJ,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,KAAK,EAAE;YAAE,OAAO,IAAI,CAAC;SAAE;KAC5D;IAED,sCAAsC;IACtC,IAAI,MAAM,GAA0D,EAAE,CAAC;IACvE,KAAK,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,GAAG,EAAE,EAAE;QACjD,IAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC7B,IAAI,MAAM,CAAC,SAAS,IAAI,CAAC,cAAc,EAAE;YAAE,SAAS;SAAE;QACtD,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,GAAG,EAAE,MAAM,EAAE,CAAC;QACtD,IAAI,IAAI,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAG9C,IAAI,KAAK,CAAC,SAAS,EAAE;YACpB,QAAQ,GAAG,IAAI,oDAAS,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;SAClD;QAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG;YAC1C,IAAI,CAAC,GAAG,CAAC,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC;YACtF,IAAI,OAAO,GAAG,CAAC,CAAC;YAChB,IAAI,CAAC,MAAM,EAAE;gBACZ,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;gBAC/H,CAAC,IAAI,CAAC,CAAC;aACP;iBACI;gBACJ,IAAI,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;gBACrC,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;gBACjJ,CAAC,IAAI,CAAC,CAAC;aACP;YACD,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC;YAC1C,6DAA6D;YAC7D,IAAI,QAAQ,EAAE;gBAAE,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;aAAE;SAC9G;QACD,MAAM,CAAC,GAAG,CAAC,CAAC,SAAS,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;QACzD,IAAI,QAAQ,EAAE;YAAE,QAAQ,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,MAAM,CAAC,GAAG,EAAE,KAAK,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,SAAS,EAAE,QAAQ,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,GAAG,EAAE,QAAS,EAAE,CAAC,CAAC;SAAE;KAChI;IAED,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,SAAS,GAAG,CAAC,CAAC,SAAS,CAAC,CAAC;IAEjD,IAAI,KAAK,CAAC,eAAe,EAAE;QAC1B,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;KACpG;IAED,IAAI,MAAM,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IACvB,IAAI,CAAC,MAAM,IAAI,MAAM,CAAC,KAAK,GAAG,GAAG,EAAE;QAAE,OAAO,IAAI,CAAC;KAAE;IAEnD,OAAO,EAAE,GAAG,EAAE,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,QAAQ,EAAE,MAAM,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,KAAK,EAAE,MAAM,CAAC,KAAK,EAAE,SAAS,EAAE,MAAM,CAAC,SAAS,EAAE,CAAC;AACtI,CAAC;AAGD;;;;;;;;;;;;;GAaG;AACI,SAAS,YAAY,CAAC,SAAoB,EAAE,KAAa,EAAE,OAAe,EAAE,QAAoC,EAAE,KAAa,EAAE,UAAkB,EAAE,QAAgB,EAAE,MAAe;IAC5L,eAAe;IACf,QAAQ,IAAI,GAAG,CAAC;IAEhB,cAAc;IACd,IAAI,IAAI,GAAG,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;IAChC,IAAI,IAAI,GAAG,CAAC,CAAC;IACb,IAAI,IAAI,GAAG,EAAE,KAAK,EAAE,EAAgB,EAAE,KAAK,EAAE,CAAC,EAAE,UAAU,EAAE,UAAU,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC;IAC9G,IAAI,EAAE,GAAmB,KAAK,CAAC;IAI/B,IAAI,QAAQ,GAAuB,EAAE,CAAC;IACtC,iBAAiB;IACjB,KAAK,IAAI,EAAE,GAAG,CAAC,EAAE,EAAE,GAAG,SAAS,CAAC,KAAK,EAAE,EAAE,EAAE,EAAE;QAC5C,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,SAAS,CAAC,KAAK,GAAG,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAE9D,IAAI,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,GAAG,EAAE;YAC7D,IAAI,EAAE,KAAK,KAAK,EAAE;gBAAE,EAAE,GAAG,EAAE,CAAC;aAAE;SAC9B;aACI;YACJ,IAAI,EAAE,KAAK,KAAK,EAAE;gBACjB,6BAA6B;gBAC7B,IAAI,EAAE,GAAG,EAAE,CAAC;gBACZ,IAAI,IAAI,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;gBAClC,IAAI,GAAG,GAAqB;oBAC3B,EAAE,EAAE,EAAE;oBACN,EAAE,EAAE,EAAE;oBACN,KAAK,EAAE,EAAE,GAAG,EAAE;oBACd,GAAG,EAAE,IAAI;oBACT,KAAK,EAAE,CAAC,QAAQ,IAAI,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC;oBACxC,SAAS,EAAE,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC;oBACxD,MAAM,EAAE,EAAE;iBACV,CAAC;gBACF,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBACnB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC;gBAE7C,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE;oBAC7B,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;wBAC1C,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,KAAK,GAAG,CAAC,CAAC;wBAC/C,IAAI,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,QAAQ,EAAE;4BAClC,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;4BACzB,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;yBACzB;qBACD;iBACD;gBACD,EAAE,GAAG,KAAK,CAAC;aACX;SACD;KACD;IACD,IAAI,CAAC,MAAM,GAAG,IAAI,GAAG,CAAC,GAAG,IAAI,CAAC;IAC9B,IAAI,CAAC,KAAK,GAAG,KAAK,GAAG,IAAI,CAAC;IAE1B,mBAAmB;IACnB,KAAK,IAAI,CAAC,IAAI,QAAQ,EAAE;QACvB,IAAI,GAAG,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;QACtB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,KAAK,EAAE,CAAC,EAAE,EAAE;YACnC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,GAAG,CAAC,GAAG,IAAI,EAAE,CAAC,EAAE,EAAE;gBACzC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,SAAS,CAAC,KAAK,GAAG,CAAC,CAAC;gBAC5D,IAAI,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,QAAQ,EAAE;oBAClC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBACtB,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;oBACnC,IAAI,MAAM,EAAE;wBAAE,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;qBAAE;oBACvD,GAAG,CAAC,KAAK,IAAI,CAAC,CAAC;iBACf;aACD;SACD;QACD,mEAAmE;QACnE,GAAG,CAAC,KAAK,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QAElC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,GAAG,CAAC,KAAK,EAAE,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,MAAM,EAAE,GAAG,CAAC,MAAM,EAAE,SAAS,EAAE,GAAG,CAAC,SAAS,EAAE,CAAC,CAAC;KACpH;IAED,OAAO,IAAI,CAAC;AACb,CAAC;;;;;;;;;;;;;;;;ACrmBD,wD","file":"index.bundle.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@alt1/base\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@alt1/base\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@alt1/ocr\"] = factory(require(\"@alt1/base\"));\n\telse\n\t\troot[\"OCR\"] = factory(root[\"A1lib\"]);\n})((typeof self!='undefined'?self:this), function(__WEBPACK_EXTERNAL_MODULE__alt1_base__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import { ImageData, RectLike, Rect } from \"@alt1/base\";\r\n\r\nexport type TextFragment = {\r\n\ttext: string,\r\n\tcolor: ColortTriplet,\r\n\tindex: number,\r\n\txstart: number,\r\n\txend: number\r\n};\r\nexport type Charinfo = {\r\n\twidth: number,\r\n\tchr: string,\r\n\tbonus: number,\r\n\tsecondary: boolean,\r\n\tpixels: number[]\r\n};\r\nexport type FontDefinition = {\r\n\tchars: Charinfo[],\r\n\twidth: number,\r\n\tspacewidth: number,\r\n\tshadow: boolean,\r\n\theight: number,\r\n\tbasey: number,\r\n\tminrating?: number,\r\n\tmaxspaces?: number\r\n};\r\nexport type ColortTriplet = [number, number, number];\r\n\r\nexport var debug = {\r\n\tprintcharscores: false,\r\n\ttrackread: false\r\n};\r\n\r\ntype Chardebug = { chr: string, rawscore: number, score: number, img: ImageData };\r\nexport var debugout = {} as { [id: string]: Chardebug[] };\r\n\r\n/**\r\n * draws the font definition to a buffer and displays it in the dom for debugging purposes\r\n * @param font\r\n */\r\nexport function debugFont(font: FontDefinition) {\r\n\tvar spacing = font.width + 2;\r\n\tvar buf = new ImageData(spacing * font.chars.length, font.height + 1);\r\n\tfor (var a = 0; a < buf.data.length; a += 4) {\r\n\t\tbuf.data[a] = buf.data[a + 1] = buf.data[a + 2] = 0;\r\n\t\tbuf.data[a + 3] = 255;\r\n\t}\r\n\tfor (var a = 0; a < font.chars.length; a++) {\r\n\t\tvar bx = a * spacing;\r\n\t\tvar chr = font.chars[a];\r\n\t\tfor (var b = 0; b < chr.pixels.length; b += (font.shadow ? 4 : 3)) {\r\n\t\t\tbuf.setPixel(bx + chr.pixels[b], chr.pixels[b + 1], [chr.pixels[b + 2], chr.pixels[b + 2], chr.pixels[b + 2], 255]);\r\n\t\t\tif (font.shadow) {\r\n\t\t\t\tbuf.setPixel(bx + chr.pixels[b], chr.pixels[b + 1], [chr.pixels[b + 3], 0, 0, 255]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tbuf.show()\r\n}\r\n\r\nexport function unblendBlackBackground(img: ImageData, r: number, g: number, b: number) {\r\n\tvar rimg = new ImageData(img.width, img.height);\r\n\tfor (var i = 0; i < img.data.length; i += 4) {\r\n\t\tvar col = decomposeblack(img.data[i], img.data[i + 1], img.data[i + 2], r, g, b);\r\n\t\trimg.data[i + 0] = col[0] * 255;\r\n\t\trimg.data[i + 1] = rimg.data[i + 0];\r\n\t\trimg.data[i + 2] = rimg.data[i + 0];\r\n\t\trimg.data[i + 3] = 255;\r\n\t}\r\n\treturn rimg;\r\n}\r\n\r\n/**\r\n * unblends a imagebuffer into match strength with given color\r\n * the bgimg argument should contain a second image with pixel occluded by the font visible.\r\n * @param img \r\n * @param shadow detect black as second color\r\n * @param bgimg optional second image to \r\n */\r\nexport function unblendKnownBg(img: ImageData, bgimg: ImageData, shadow: boolean, r: number, g: number, b: number) {\r\n\tif (bgimg && (img.width != bgimg.width || img.height != bgimg.height)) { throw \"bgimg size doesn't match\"; }\r\n\tvar rimg = new ImageData(img.width, img.height);\r\n\tvar totalerror = 0;\r\n\tfor (var i = 0; i < img.data.length; i += 4) {\r\n\t\tvar col = decompose2col(img.data[i], img.data[i + 1], img.data[i + 2], r, g, b, bgimg.data[i + 0], bgimg.data[i + 1], bgimg.data[i + 2]);\r\n\t\tif (shadow) {\r\n\t\t\tif (col[2] > 0.01) { console.log(\"high error component: \" + (col[2] * 100).toFixed(1) + \"%\"); }\r\n\t\t\ttotalerror += col[2];\r\n\t\t\tvar m = 1 - col[1] - Math.abs(col[2]);//main color+black=100%-bg-error\r\n\t\t\trimg.data[i + 0] = m * 255;\r\n\t\t\trimg.data[i + 1] = col[0] / m * 255;\r\n\t\t\trimg.data[i + 2] = rimg.data[i + 0];\r\n\t\t} else {\r\n\t\t\trimg.data[i + 0] = col[0] * 255;\r\n\t\t\trimg.data[i + 1] = rimg.data[i + 0];\r\n\t\t\trimg.data[i + 2] = rimg.data[i + 0];\r\n\t\t}\r\n\t\trimg.data[i + 3] = 255;\r\n\t}\r\n\treturn rimg;\r\n}\r\n\r\n/**\r\n * Unblends a font image that is already conpletely isolated to the raw image used ingame. This is the easiest mode for pixel fonts where alpha is 0 or 255, or for extracted font files.\r\n * @param img\r\n * @param r\r\n * @param g\r\n * @param b\r\n * @param shadow whether the font has a black shadow\r\n */\r\nexport function unblendTrans(img: ImageData, shadow: boolean, r: number, g: number, b: number) {\r\n\tvar rimg = new ImageData(img.width, img.height);\r\n\tvar pxlum = r + g + b;\r\n\tfor (var i = 0; i < img.data.length; i += 4) {\r\n\t\tif (shadow) {\r\n\t\t\tvar lum = img.data[i + 0] + img.data[i + 1] + img.data[i + 2];\r\n\t\t\trimg.data[i + 0] = img.data[i + 3];\r\n\t\t\trimg.data[i + 1] = lum / pxlum * 255;\r\n\t\t\trimg.data[i + 2] = rimg.data[i + 0];\r\n\t\t} else {\r\n\t\t\trimg.data[i + 0] = img.data[i + 3];\r\n\t\t\trimg.data[i + 1] = rimg.data[i + 0];\r\n\t\t\trimg.data[i + 2] = rimg.data[i + 0];\r\n\t\t}\r\n\t\trimg.data[i + 3] = 255;\r\n\t}\r\n\treturn rimg;\r\n}\r\n\r\n/**\r\n * Determised wether color [rgb]m can be a result of a blend with color [rgb]1 that is p (0-1) of the mix\r\n * It returns the number that the second color has to lie outside of the possible color ranges\r\n * @param rm resulting color\r\n * @param r1 first color of the mix (the other color is unknown)\r\n * @param p the portion of the [rgb]1 in the mix (0-1)\r\n */\r\nexport function canblend(rm: number, gm: number, bm: number, r1: number, g1: number, b1: number, p: number) {\r\n\tvar m = Math.min(50, p / (1 - p));\r\n\tvar r = rm + (rm - r1) * m;\r\n\tvar g = gm + (gm - g1) * m;\r\n\tvar b = bm + (bm - b1) * m;\r\n\treturn Math.max(-r, -g, -b, r - 255, g - 255, b - 255);\r\n}\r\n\r\n\r\n/**\r\n * decomposes a color in 2 given component colors and returns the amount of each color present\r\n * also return a third (noise) component which is the the amount leftover orthagonal from the 2 given colors\r\n */\r\nexport function decompose2col(rp: number, gp: number, bp: number, r1: number, g1: number, b1: number, r2: number, g2: number, b2: number) {\r\n\t//get the normal of the error (cross-product of both colors)\r\n\tvar r3 = g1 * b2 - g2 * b1;\r\n\tvar g3 = b1 * r2 - b2 * r1;\r\n\tvar b3 = r1 * g2 - r2 * g1;\r\n\r\n\t//normalize to length 255\r\n\tvar norm = 255 / Math.sqrt(r3 * r3 + g3 * g3 + b3 * b3);\r\n\tr3 *= norm;\r\n\tg3 *= norm;\r\n\tb3 *= norm;\r\n\r\n\treturn decompose3col(rp, gp, bp, r1, g1, b1, r2, g2, b2, r3, g3, b3);\r\n}\r\n\r\n/**\r\n * decomposes a pixel in a given color component and black and returns what proportion of the second color it contains\r\n * this is not as formal as decompose 2/3 and only give a \"good enough\" number\r\n */\r\nexport function decomposeblack(rp: number, gp: number, bp: number, r1: number, g1: number, b1: number) {\r\n\tvar dr = Math.abs(rp - r1);\r\n\tvar dg = Math.abs(gp - g1);\r\n\tvar db = Math.abs(bp - b1);\r\n\tvar maxdif = Math.max(dr, dg, db);\r\n\treturn [1 - maxdif / 255];\r\n}\r\n\r\n/**\r\n * decomposes a color in 3 given component colors and returns the amount of each color present\r\n */\r\nexport function decompose3col(rp: number, gp: number, bp: number, r1: number, g1: number, b1: number, r2: number, g2: number, b2: number, r3: number, g3: number, b3: number) {\r\n\t//P=x*C1+y*C2+z*C3\r\n\t//assemble as matrix \r\n\t//M*w=p\r\n\t//get inverse of M\r\n\t//dirty written out version of cramer's rule\r\n\tvar A = g2 * b3 - b2 * g3;\r\n\tvar B = g3 * b1 - b3 * g1;\r\n\tvar C = g1 * b2 - b1 * g2;\r\n\r\n\tvar D = b2 * r3 - r2 * b3;\r\n\tvar E = b3 * r1 - r3 * b1;\r\n\tvar F = b1 * r2 - r1 * b2;\r\n\r\n\tvar G = r2 * g3 - g2 * r3;\r\n\tvar H = r3 * g1 - g3 * r1;\r\n\tvar I = r1 * g2 - g1 * r2;\r\n\r\n\tvar det = r1 * A + g1 * D + b1 * G;\r\n\r\n\t//M^-1*p=w\r\n\tvar x = (A * rp + D * gp + G * bp) / det;\r\n\tvar y = (B * rp + E * gp + H * bp) / det;\r\n\tvar z = (C * rp + F * gp + I * bp) / det;\r\n\r\n\treturn [x, y, z];\r\n}\r\n\r\n/**\r\n * brute force to the exact position of the text\r\n */\r\nexport function findChar(buffer: ImageData, font: FontDefinition, col: ColortTriplet, x: number, y: number, w: number, h: number) {\r\n\tif (x < 0) { return null; }\r\n\tif (y - font.basey < 0) { return null; }\r\n\tif (x + w + font.width > buffer.width) { return null; }\r\n\tif (y + h - font.basey + font.height > buffer.height) { return null; }\r\n\r\n\tvar best = 1000;//TODO finetune score constants\r\n\tvar bestchar: ReadCharInfo | null = null;\r\n\tfor (var cx = x; cx < x + w; cx++) {\r\n\t\tfor (var cy = y; cy < y + h; cy++) {\r\n\t\t\tvar chr = readChar(buffer, font, col, cx, cy, false, false);\r\n\t\t\tif (chr != null && chr.sizescore < best) {\r\n\t\t\t\tbest = chr.sizescore;\r\n\t\t\t\tbestchar = chr;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn bestchar;\r\n}\r\n\r\n/**\r\n * reads text with unknown exact coord or color. The given coord should be inside the text\r\n * color selection not implemented yet\r\n */\r\nexport function findReadLine(buffer: ImageData, font: FontDefinition, cols: ColortTriplet[], x: number, y: number, w = -1, h = -1) {\r\n\tif (w == -1) { w = font.width + font.spacewidth; x -= Math.ceil(w / 2); }\r\n\tif (h == -1) { h = 7; y -= 1; }\r\n\tvar chr: ReturnType<typeof findChar> = null;\r\n\tif (cols.length > 1) {\r\n\t\t//TODO use getChatColor() instead for non-mono?\r\n\t\tvar sorted = GetChatColorMono(buffer, new Rect(x, y - font.basey, w, h), cols);\r\n\t\t//loop until we have a match (max 2 cols)\r\n\t\tfor (var a = 0; a < 2 && a < sorted.length && chr == null; a++) {\r\n\t\t\tchr = findChar(buffer, font, sorted[a].col, x, y, w, h);\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tchr = findChar(buffer, font, cols[0], x, y, w, h);\r\n\t}\r\n\tif (chr == null) { return { debugArea: { x, y, w, h }, text: \"\", fragments: [] } as ReturnType<typeof readLine>; }\r\n\treturn readLine(buffer, font, cols, chr.x, chr.y, true, true);\r\n}\r\n\r\nexport function GetChatColorMono(buf: ImageData, rect: RectLike, colors: ColortTriplet[]) {\r\n\tvar colormap = colors.map(c => ({ col: c, score: 0 }));\r\n\tif (rect.x < 0 || rect.y < 0 || rect.x + rect.width > buf.width || rect.y + rect.height > buf.height) { return colormap; }\r\n\tvar data = buf.data;\r\n\tvar maxd = 50;\r\n\tfor (var colobj of colormap) {\r\n\t\tvar score = 0;\r\n\t\tvar col = colobj.col;\r\n\t\tfor (var y = rect.y; y < rect.y + rect.height; y++) {\r\n\t\t\tfor (var x = rect.x; x < rect.x + rect.width; x++) {\r\n\t\t\t\tvar i = x * 4 + y * 4 * buf.width;\r\n\t\t\t\tvar d = Math.abs(data[i] - col[0]) + Math.abs(data[i + 1] - col[1]) + Math.abs(data[i + 2] - col[2]);\r\n\t\t\t\tif (d < maxd) { score += maxd - d; }\r\n\t\t\t}\r\n\t\t}\r\n\t\tcolobj.score = score;\r\n\t}\r\n\treturn colormap.sort((a, b) => b.score - a.score);\r\n}\r\n\r\n\r\nfunction unblend(r: number, g: number, b: number, R: number, G: number, B: number) {\r\n\tvar m = Math.sqrt(r * r + g * g + b * b);\r\n\tvar n = Math.sqrt(R * R + G * G + B * B);\r\n\r\n\tvar x = (r * R + g * G + b * B) / n;\r\n\tvar y = Math.sqrt(Math.max(0, m * m - x * x));\r\n\r\n\tvar r1 = Math.max(0, (63.75 - y) * 4);\r\n\tvar r2 = x / n * 255;\r\n\r\n\tif (r2 > 255)//brighter than refcol\r\n\t{\r\n\t\tr1 = Math.max(0, r1 - r2 + 255);\r\n\t\tr2 = 255;\r\n\t}\r\n\r\n\treturn [r1, r2];\r\n}\r\n\r\n\r\nexport function getChatColor(buf: ImageData, rect: RectLike, colors: ColortTriplet[]) {\r\n\tvar bestscore = -1.0;\r\n\tvar best: null | ColortTriplet = null;\r\n\tvar b2 = 0.0;\r\n\tvar data = buf.data;\r\n\tfor (let col of colors) {\r\n\t\tvar score = 0.0;\r\n\t\tfor (var y = rect.y; y < rect.y + rect.height; y++) {\r\n\t\t\tfor (var x = rect.x; x < rect.x + rect.width; x++) {\r\n\t\t\t\tif (x < 0 || x + 1 >= buf.width) { continue; }\r\n\t\t\t\tif (y < 0 || y + 1 >= buf.width) { continue; }\r\n\t\t\t\tlet i1 = buf.pixelOffset(x, y);\r\n\t\t\t\tlet i2 = buf.pixelOffset(x + 1, y + 1);\r\n\t\t\t\tvar pixel1 = unblend(data[i1 + 0], data[i1 + 1], data[i1 + 2], col[0], col[1], col[2]);\r\n\t\t\t\tvar pixel2 = unblend(data[i2 + 0], data[i2 + 1], data[i2 + 2], col[0], col[1], col[2]);\r\n\t\t\t\t//TODO this is from c# can simplify a bit\r\n\t\t\t\tvar s = (pixel1[0] / 255 * pixel1[1] / 255) * (pixel2[0] / 255 * (255.0 - pixel2[1]) / 255);\r\n\t\t\t\tscore += s;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (score > bestscore) { b2 = bestscore; bestscore = score; best = col; }\r\n\t\telse if (score > b2) { b2 = score; }\r\n\t}\r\n\t//Console.WriteLine(\"color: \" + bestcol + \" - \" + (bestscore - b2));\r\n\t//bestscore /= rect.width * rect.height;\r\n\treturn best;\r\n}\r\n\r\n/**\r\n * reads a line of text with exactly known position and color. y should be the y coord of the text base line, x should be the first pixel of a new character\r\n */\r\nexport function readLine(buffer: ImageData, font: FontDefinition, colors: ColortTriplet | ColortTriplet[], x: number, y: number, forward: boolean, backward = false) {\r\n\tif (typeof colors[0] != \"number\" && colors.length == 1) { colors = colors[0] as ColortTriplet; }\r\n\tvar multicol = typeof colors[0] != \"number\";\r\n\tvar allcolors: ColortTriplet[] = multicol ? colors as ColortTriplet[] : [colors as ColortTriplet];\r\n\r\n\tvar detectcolor = function (sx: number, sy: number, backward: boolean) {\r\n\t\tvar w = Math.floor(font.width * 1.5);\r\n\t\tif (backward) { sx -= w; }\r\n\t\tsy -= font.basey;\r\n\t\treturn getChatColor(buffer, { x: sx, y: sy, width: w, height: font.height }, allcolors);\r\n\t}\r\n\r\n\tvar fragments: TextFragment[] = [];\r\n\tvar x1 = x;\r\n\tvar x2 = x;\r\n\tvar maxspaces = (typeof font.maxspaces == \"number\" ? font.maxspaces : 1);\r\n\r\n\tlet fragtext = \"\";\r\n\tlet fraghadprimary = false;\r\n\tvar lastcol: ColortTriplet | null = null;\r\n\tlet addfrag = (forward: boolean) => {\r\n\t\tif (!fragtext) { return; }\r\n\t\tlet frag: TextFragment = {\r\n\t\t\ttext: fragtext,\r\n\t\t\tcolor: lastcol!,\r\n\t\t\tindex: 0,\r\n\t\t\txstart: x + (forward ? fragstartdx : fragenddx),\r\n\t\t\txend: x + (forward ? fragenddx : fragstartdx)\r\n\t\t};\r\n\t\tif (forward) { fragments.push(frag); }\r\n\t\telse { fragments.unshift(frag); }\r\n\t\tfragtext = \"\";\r\n\t\tfragstartdx = dx;\r\n\t\tfraghadprimary = false;\r\n\t}\r\n\r\n\tfor (var dirforward of [true, false]) {\r\n\t\t//init vars\r\n\t\tif (dirforward && !forward) { continue; }\r\n\t\tif (!dirforward && !backward) { continue; }\r\n\r\n\t\tvar dx = 0;\r\n\t\tvar fragstartdx = dx;\r\n\t\tvar fragenddx = dx;\r\n\t\tvar triedspaces = 0;\r\n\t\tvar triedrecol = false;\r\n\t\tvar col = multicol ? null : colors as ColortTriplet;\r\n\r\n\t\twhile (true) {\r\n\t\t\tcol = col || detectcolor(x + dx, y, !dirforward);\r\n\t\t\tvar chr = (col ? readChar(buffer, font, col, x + dx, y, !dirforward, true) : null);\r\n\t\t\tif (col == null || chr == null) {\r\n\t\t\t\tif (triedspaces < maxspaces) {\r\n\t\t\t\t\tdx += (dirforward ? 1 : -1) * font.spacewidth;\r\n\t\t\t\t\ttriedspaces++;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (multicol && !triedrecol && fraghadprimary) {\r\n\t\t\t\t\tdx -= (dirforward ? 1 : -1) * triedspaces * font.spacewidth;\r\n\t\t\t\t\ttriedspaces = 0;\r\n\t\t\t\t\tcol = null;\r\n\t\t\t\t\ttriedrecol = true;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (dirforward) { x2 = x + dx - font.spacewidth; }\r\n\t\t\t\telse { x1 = x + dx + font.spacewidth; }\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tif (lastcol && (col[0] != lastcol[0] || col[1] != lastcol[1] || col[2] != lastcol[2])) {\r\n\t\t\t\t\taddfrag(dirforward);\r\n\t\t\t\t}\r\n\t\t\t\tvar spaces = \"\";\r\n\t\t\t\tfor (var a = 0; a < triedspaces; a++) { spaces += \" \"; }\r\n\t\t\t\tif (dirforward) { fragtext += spaces + chr.chr; }\r\n\t\t\t\telse { fragtext = chr.chr + spaces + fragtext; }\r\n\t\t\t\tif (!chr.basechar.secondary) { fraghadprimary = true; }\r\n\t\t\t\ttriedspaces = 0;\r\n\t\t\t\ttriedrecol = false;\r\n\t\t\t\tdx += (dirforward ? 1 : -1) * chr.basechar.width;\r\n\t\t\t\tfragenddx = dx;\r\n\t\t\t\tlastcol = col;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (lastcol && fraghadprimary) { addfrag(dirforward); }\r\n\t}\r\n\r\n\tfragments.forEach((f, i) => f.index = i);\r\n\r\n\treturn {\r\n\t\tdebugArea: { x: x1, y: y - 9, w: x2 - x1, h: 10 },\r\n\t\ttext: fragments.map(f => f.text).join(\"\"),\r\n\t\tfragments\r\n\t};\r\n}\r\n\r\n/**\r\n * Reads a line of text that uses a smallcaps font, these fonts can have duplicate chars that only have a different amount of \r\n * empty space after the char before the next char starts. \r\n * The coordinates should be near the end of the string, or a rectangle with high 1 containing all points where the string can end.\r\n */\r\nexport function readSmallCapsBackwards(buffer: ImageData, font: FontDefinition, cols: ColortTriplet[], x: number, y: number, w = -1, h = -1) {\r\n\tif (w == -1) { w = font.width + font.spacewidth; x -= Math.ceil(w / 2); }\r\n\tif (h == -1) { h = 7; y -= 1; }\r\n\tvar matchedchar: ReadCharInfo | null = null;\r\n\tvar sorted = (cols.length == 1 ? [{ col: cols[0], score: 1 }] : GetChatColorMono(buffer, new Rect(x, y - font.basey, w, h), cols));\r\n\t//loop until we have a match (max 2 cols)\r\n\tfor (var a = 0; a < 2 && a < sorted.length && matchedchar == null; a++) {\r\n\t\tfor (var cx = x + w - 1; cx >= x; cx--) {\r\n\t\t\tvar best = 1000;//TODO finetune score constants\r\n\t\t\tvar bestchar: ReadCharInfo | null = null;\r\n\t\t\tfor (var cy = y; cy < y + h; cy++) {\r\n\t\t\t\tvar chr = readChar(buffer, font, sorted[a].col, cx, cy, true, false);\r\n\t\t\t\tif (chr != null && chr.sizescore < best) {\r\n\t\t\t\t\tbest = chr.sizescore;\r\n\t\t\t\t\tbestchar = chr;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (bestchar) {\r\n\t\t\t\tmatchedchar = bestchar;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (matchedchar == null) { return { text: \"\", debugArea: { x, y, w, h } }; }\r\n\treturn readLine(buffer, font, cols, matchedchar.x, matchedchar.y, false, true);\r\n}\r\n/**\r\n * Reads a single character at the exact given location\r\n * @param x exact x location of the start of the character domain (includes part of the spacing between characters)\r\n * @param y exact y location of the baseline pixel of the character\r\n * @param backwards read in backwards direction, the x location should be the first pixel after the character domain in that case\r\n */\r\nexport function readChar(buffer: ImageData, font: FontDefinition, col: ColortTriplet, x: number, y: number, backwards: boolean, allowSecondary?: boolean): ReadCharInfo | null {\r\n\ty -= font.basey;\r\n\tvar shiftx = 0;\r\n\tvar shifty = font.basey;\r\n\tvar shadow = font.shadow;\r\n\tvar debugobj: Chardebug[] | null = null;\r\n\tvar debugimg: ImageData | null = null;\r\n\tif (debug.trackread) {\r\n\t\tvar name = x + \";\" + y + \" \" + JSON.stringify(col);\r\n\t\tif (!debugout[name]) { debugout[name] = []; }\r\n\t\tdebugobj = debugout[name];\r\n\t}\r\n\r\n\t//===== make sure the full domain is inside the bitmap/buffer ======\r\n\tif (y < 0 || y + font.height >= buffer.height) { return null; }\r\n\tif (!backwards) {\r\n\t\tif (x < 0 || x + font.width > buffer.width) { return null; }\r\n\t}\r\n\telse {\r\n\t\tif (x - font.width < 0 || x > buffer.width) { return null; }\r\n\t}\r\n\r\n\t//====== start reading the char ======\r\n\tvar scores: { score: number, sizescore: number, chr: Charinfo }[] = [];\r\n\tfor (var chr = 0; chr < font.chars.length; chr++) {\r\n\t\tvar chrobj = font.chars[chr];\r\n\t\tif (chrobj.secondary && !allowSecondary) { continue; }\r\n\t\tscores[chr] = { score: 0, sizescore: 0, chr: chrobj };\r\n\t\tvar chrx = (backwards ? x - chrobj.width : x);\r\n\r\n\r\n\t\tif (debug.trackread) {\r\n\t\t\tdebugimg = new ImageData(font.width, font.height);\r\n\t\t}\r\n\r\n\t\tfor (var a = 0; a < chrobj.pixels.length;) {\r\n\t\t\tvar i = (chrx + chrobj.pixels[a]) * 4 + (y + chrobj.pixels[a + 1]) * buffer.width * 4;\r\n\t\t\tvar penalty = 0;\r\n\t\t\tif (!shadow) {\r\n\t\t\t\tpenalty = canblend(buffer.data[i], buffer.data[i + 1], buffer.data[i + 2], col[0], col[1], col[2], chrobj.pixels[a + 2] / 255);\r\n\t\t\t\ta += 3;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar lum = chrobj.pixels[a + 3] / 255;\r\n\t\t\t\tpenalty = canblend(buffer.data[i], buffer.data[i + 1], buffer.data[i + 2], col[0] * lum, col[1] * lum, col[2] * lum, chrobj.pixels[a + 2] / 255);\r\n\t\t\t\ta += 4;\r\n\t\t\t}\r\n\t\t\tscores[chr].score += Math.max(0, penalty);\r\n\t\t\t//TODO add compiler flag to this to remove it for performance\r\n\t\t\tif (debugimg) { debugimg.setPixel(chrobj.pixels[a], chrobj.pixels[a + 1], [penalty, penalty, penalty, 255]); }\r\n\t\t}\r\n\t\tscores[chr].sizescore = scores[chr].score - chrobj.bonus;\r\n\t\tif (debugobj) { debugobj.push({ chr: chrobj.chr, score: scores[chr].sizescore, rawscore: scores[chr].score, img: debugimg! }); }\r\n\t}\r\n\r\n\tscores.sort((a, b) => a.sizescore - b.sizescore);\r\n\r\n\tif (debug.printcharscores) {\r\n\t\tscores.slice(0, 5).forEach(q => console.log(q.chr.chr, q.score.toFixed(3), q.sizescore.toFixed(3)));\r\n\t}\r\n\r\n\tvar winchr = scores[0];\r\n\tif (!winchr || winchr.score > 400) { return null; }\r\n\r\n\treturn { chr: winchr.chr.chr, basechar: winchr.chr, x: x + shiftx, y: y + shifty, score: winchr.score, sizescore: winchr.sizescore };\r\n}\r\nexport type ReadCharInfo = { chr: string, basechar: Charinfo, x: number, y: number, score: number, sizescore: number };\r\n\r\n/**\r\n * Generates a font json description to use in reader functions\r\n * @param unblended A source image with all characters lined up. The image should be unblended into components using the unblend functions\r\n * The lowest pixel line of this image is used to mark the location and size of the charecters if the red component is 255 it means there is a character on that pixel column\r\n * @param chars A string containing all the characters of the image in the same order\r\n * @param seconds A string with characters that are considered unlikely and should only be detected if no other character is possible.\r\n * For example the period (.) character matches positive inside many other characters and should be marked as secondary\r\n * @param bonusses An object that contains bonus scores for certain difficult characters to make the more likely to be red.\r\n * @param basey The y position of the baseline pixel of the font\r\n * @param spacewidth the number of pixels a space takes\r\n * @param treshold minimal color match proportion (0-1) before a pixel is used for the font\r\n * @param shadow whether this font also uses the black shadow some fonts have. The \"unblended\" image should be unblended correspondingly\r\n * @returns a javascript object describing the font which is used as input for the different read functions\r\n */\r\nexport function generatefont(unblended: ImageData, chars: string, seconds: string, bonusses: { [char: string]: number }, basey: number, spacewidth: number, treshold: number, shadow: boolean): FontDefinition {\r\n\t//settings vars\r\n\ttreshold *= 255;\r\n\r\n\t//initial vars\r\n\tvar miny = unblended.height - 1;\r\n\tvar maxy = 0;\r\n\tvar font = { chars: [] as Charinfo[], width: 0, spacewidth: spacewidth, shadow: shadow, height: 0, basey: 0 };\r\n\tvar ds: false | number = false;\r\n\r\n\ttype internalcharinfo = Charinfo & { ds: number, de: number };\r\n\r\n\tvar chardata: internalcharinfo[] = [];\r\n\t//index all chars\r\n\tfor (var dx = 0; dx < unblended.width; dx++) {\r\n\t\tvar i = 4 * dx + 4 * unblended.width * (unblended.height - 1);\r\n\r\n\t\tif (unblended.data[i] == 255 && unblended.data[i + 3] == 255) {\r\n\t\t\tif (ds === false) { ds = dx; }\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (ds !== false) {\r\n\t\t\t\t//char found, start detection\r\n\t\t\t\tvar de = dx;\r\n\t\t\t\tvar char = chars[chardata.length];\r\n\t\t\t\tvar chr: internalcharinfo = {\r\n\t\t\t\t\tds: ds,\r\n\t\t\t\t\tde: de,\r\n\t\t\t\t\twidth: de - ds,\r\n\t\t\t\t\tchr: char,\r\n\t\t\t\t\tbonus: (bonusses && bonusses[char]) || 0,\r\n\t\t\t\t\tsecondary: seconds.indexOf(chars[chardata.length]) != -1,\r\n\t\t\t\t\tpixels: []\r\n\t\t\t\t};\r\n\t\t\t\tchardata.push(chr);\r\n\t\t\t\tfont.width = Math.max(font.width, chr.width);\r\n\r\n\t\t\t\tfor (x = 0; x < de - ds; x++) {\r\n\t\t\t\t\tfor (y = 0; y < unblended.height - 1; y++) {\r\n\t\t\t\t\t\tvar i = (x + ds) * 4 + y * unblended.width * 4;\r\n\t\t\t\t\t\tif (unblended.data[i] >= treshold) {\r\n\t\t\t\t\t\t\tminy = Math.min(miny, y);\r\n\t\t\t\t\t\t\tmaxy = Math.max(maxy, y);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tds = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfont.height = maxy + 1 - miny;\r\n\tfont.basey = basey - miny;\r\n\r\n\t//detect all pixels\r\n\tfor (var a in chardata) {\r\n\t\tvar chr = chardata[a];\r\n\t\tfor (var x = 0; x < chr.width; x++) {\r\n\t\t\tfor (var y = 0; y < maxy + 1 - miny; y++) {\r\n\t\t\t\tvar i = (x + chr.ds) * 4 + (y + miny) * unblended.width * 4;\r\n\t\t\t\tif (unblended.data[i] >= treshold) {\r\n\t\t\t\t\tchr.pixels.push(x, y);\r\n\t\t\t\t\tchr.pixels.push(unblended.data[i]);\r\n\t\t\t\t\tif (shadow) { chr.pixels.push(unblended.data[i + 1]); }\r\n\t\t\t\t\tchr.bonus += 5;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//prevent js from doing the thing with unnecessary output precision\r\n\t\tchr.bonus = +chr.bonus.toFixed(3);\r\n\r\n\t\tfont.chars.push({ width: chr.width, bonus: chr.bonus, chr: chr.chr, pixels: chr.pixels, secondary: chr.secondary });\r\n\t}\r\n\r\n\treturn font;\r\n}\r\n","module.exports = __WEBPACK_EXTERNAL_MODULE__alt1_base__;"],"sourceRoot":""}