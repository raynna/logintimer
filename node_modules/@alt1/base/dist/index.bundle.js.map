{"version":3,"sources":["webpack://A1lib/webpack/universalModuleDefinition","webpack://A1lib/webpack/bootstrap","webpack://A1lib/./imgref.ts","webpack://A1lib/./rect.ts","webpack://A1lib/./nodepolyfill.ts","webpack://A1lib/./imagedata-extensions.ts","webpack://A1lib/./wrapper.ts","webpack://A1lib/./imagedetect.ts","webpack://A1lib/./pasteinput.ts","webpack://A1lib/./index.ts"],"names":[],"mappings":"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","file":"index.bundle.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@alt1/base\"] = factory();\n\telse\n\t\troot[\"A1lib\"] = factory();\n})((typeof self!='undefined'?self:this), function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import { ImageDetect, transferImageData } from \"./index\";\r\nimport { RectLike } from \"./rect\";\r\n\r\n/**\r\n * Represents an image that might be in different types of memory\r\n * This is mostly used to represent images still in Alt1 memory that have\r\n * not been transfered to js yet. Various a1lib api's use this type and\r\n * choose the most efficient approach based on the memory type\r\n */\r\nexport abstract class ImgRef {\r\n\tpublic width: number;\r\n\tpublic height: number;\r\n\tpublic x: number;\r\n\tpublic y: number;\r\n\tpublic t = \"none\";\r\n\r\n\tconstructor(x: number, y: number, w: number, h: number) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.width = w;\r\n\t\tthis.height = h;\r\n\t}\r\n\r\n\tread(x = 0, y = 0, w = this.width, h = this.height): ImageData {\r\n\t\tthrow new Error(\"This imgref (\" + this.t + \") does not support toData\");\r\n\t}\r\n\r\n\tfindSubimage(needle: ImageData, sx = 0, sy = 0, w = this.width, h = this.height) {\r\n\t\treturn ImageDetect.findSubimage(this, needle, sx, sy, w, h);\r\n\t}\r\n\ttoData(x = this.x, y = this.y, w = this.width, h = this.height) {\r\n\t\treturn this.read(x - this.x, y - this.y, w, h);\r\n\t};\r\n\tcontainsArea(rect: RectLike) {\r\n\t\treturn this.x <= rect.x && this.y <= rect.y && this.x + this.width >= rect.x + rect.width && this.y + this.height >= rect.y + rect.height;\r\n\t}\r\n}\r\n\r\n/**\r\n * Represents an image in js render memory (canvas/image tag)\r\n */\r\nexport class ImgRefCtx extends ImgRef {\r\n\tctx: CanvasRenderingContext2D;\r\n\tconstructor(img: HTMLImageElement | CanvasRenderingContext2D | HTMLCanvasElement, x = 0, y = 0) {\r\n\t\tif (img instanceof CanvasRenderingContext2D) {\r\n\t\t\tsuper(x, y, img.canvas.width, img.canvas.height);\r\n\t\t\tthis.ctx = img;\r\n\t\t} else {\r\n\t\t\tsuper(x, y, img.width, img.height);\r\n\t\t\tvar cnv = (img instanceof HTMLCanvasElement ? img : img.toCanvas());\r\n\t\t\tthis.ctx = cnv.getContext(\"2d\")!;\r\n\t\t}\r\n\t\tthis.t = \"ctx\";\r\n\t}\r\n\r\n\tread(x = 0, y = 0, w = this.width, h = this.height) {\r\n\t\treturn this.ctx.getImageData(x, y, w, h);\r\n\t}\r\n}\r\n\r\n/**\r\n * Represents in image in Alt1 memory, This type of image can be searched for subimages \r\n * very efficiently and transfering the full image to js can be avoided this way\r\n */\r\nexport class ImgRefBind extends ImgRef {\r\n\thandle: number;\r\n\tconstructor(handle: number, x = 0, y = 0, w = 0, h = 0) {\r\n\t\tsuper(x, y, w, h);\r\n\t\tthis.handle = handle;\r\n\t\tthis.t = \"bind\";\r\n\t}\r\n\r\n\tread(x = 0, y = 0, w = this.width, h = this.height) {\r\n\t\treturn transferImageData(this.handle, x, y, w, h);\r\n\t}\r\n}\r\n\r\n/**\r\n * Represents an image in js memory\r\n */\r\nexport class ImgRefData extends ImgRef {\r\n\tbuf: ImageData;\r\n\tconstructor(buf: ImageData, x = 0, y = 0) {\r\n\t\tsuper(x, y, buf.width, buf.height);\r\n\t\tthis.buf = buf;\r\n\t\tthis.t = \"data\";\r\n\t}\r\n\r\n\tread(x = 0, y = 0, w = this.width, h = this.height) {\r\n\t\tif (x == 0 && y == 0 && w == this.width && h == this.height) {\r\n\t\t\treturn this.buf;\r\n\t\t}\r\n\t\tvar r = new ImageData(w, h);\r\n\t\tfor (var b = y; b < y + h; b++) {\r\n\t\t\tfor (var a = x; a < x + w; a++) {\r\n\t\t\t\tvar i1 = (a - x) * 4 + (b - y) * w * 4;\r\n\t\t\t\tvar i2 = a * 4 + b * 4 * this.buf.width;\r\n\r\n\t\t\t\tr.data[i1] = this.buf.data[i2];\r\n\t\t\t\tr.data[i1 + 1] = this.buf.data[i2 + 1];\r\n\t\t\t\tr.data[i1 + 2] = this.buf.data[i2 + 2];\r\n\t\t\t\tr.data[i1 + 3] = this.buf.data[i2 + 3];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn r;\r\n\t}\r\n}\r\n","//util class for rectangle maths\r\n//TODO shit this sucks can we remove it again?\r\n//more of a shorthand to get {x,y,width,height} than a class\r\n//kinda starting to like it again\r\n//TODO remove rant\r\n\r\nexport interface PointLike {\r\n\tx: number,\r\n\ty: number\r\n};\r\n\r\nexport interface RectLike {\r\n\tx: number;\r\n\ty: number;\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\n/**\r\n * Simple rectangle class with some util functions\r\n */\r\nexport default class Rect implements RectLike {\r\n\tx: number;\r\n\ty: number;\r\n\twidth: number;\r\n\theight: number;\r\n\tconstructor(x: number, y: number, w: number, h: number) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.width = w;\r\n\t\tthis.height = h;\r\n\t}\r\n\r\n\tstatic fromArgs(...args: [RectLike] | [x: number, y: number, w: number, h: number]): Rect {\r\n\t\tif (typeof args[0] == \"object\") {\r\n\t\t\treturn new Rect(args[0].x, args[0].y, args[0].width, args[0].height);\r\n\t\t} else if (typeof args[0] == \"number\" && args.length >= 4) {\r\n\t\t\treturn new Rect(args[0], args[1]!, args[2]!, args[3]!);\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"invalid rect args\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Resizes this Rect to include the full size of a given second rectangle\r\n\t */\r\n\tunion(r2: RectLike) {\r\n\t\tvar x = Math.min(this.x, r2.x);\r\n\t\tvar y = Math.min(this.y, r2.y);\r\n\t\tthis.width = Math.max(this.x + this.width, r2.x + r2.width) - x;\r\n\t\tthis.height = Math.max(this.y + this.height, r2.y + r2.height) - y;\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\treturn this;\r\n\t}\r\n\t/**\r\n\t * Resizes this Rect to include a given point\r\n\t */\r\n\tincludePoint(x: number, y: number) {\r\n\t\tthis.union(new Rect(x, y, 0, 0));\r\n\t}\r\n\t/**\r\n\t * Grows the rectangle with the given dimensions\r\n\t */\r\n\tinflate(w: number, h: number) {\r\n\t\tthis.x -= w;\r\n\t\tthis.y -= h;\r\n\t\tthis.width += 2 * w;\r\n\t\tthis.height += 2 * h;\r\n\t}\r\n\t/**\r\n\t * Resizes this Rect to the area that overlaps a given Rect\r\n\t * width and height will be set to 0 if the intersection does not exist\r\n\t */\r\n\tintersect(r2: RectLike) {\r\n\t\tif (this.x < r2.x) { this.width -= r2.x - this.x; this.x = r2.x; }\r\n\t\tif (this.y < r2.y) { this.height -= r2.y - this.y; this.y = r2.y; }\r\n\t\tthis.width = Math.min(this.x + this.width, r2.x + r2.width) - this.x;\r\n\t\tthis.height = Math.min(this.y + this.height, r2.y + r2.height) - this.y;\r\n\t\tif (this.width <= 0 || this.height <= 0) {\r\n\t\t\tthis.width = 0;\r\n\t\t\tthis.height = 0;\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * Returns wether this Rect has at least one pixel overlap with a given Rect\r\n\t */\r\n\toverlaps(r2: RectLike) {\r\n\t\treturn this.x < r2.x + r2.width && this.x + this.width > r2.x && this.y < r2.y + r2.height && this.y + this.height > r2.y;\r\n\t}\r\n\t/**\r\n\t * Returns wether a given Rect fits completely inside this Rect\r\n\t * @param r2\r\n\t */\r\n\tcontains(r2: RectLike) {\r\n\t\treturn this.x <= r2.x && this.x + this.width >= r2.x + r2.width && this.y <= r2.y && this.y + this.height >= r2.y + r2.height;\r\n\t}\r\n\t/**\r\n\t * Returns wether a given point lies inside this Rect\r\n\t */\r\n\tcontainsPoint(x: number, y: number) {\r\n\t\treturn this.x <= x && this.x + this.width > x && this.y <= y && this.y + this.height > y;\r\n\t}\r\n}","//nodejs and electron polyfills for web api's\r\n//commented out type info as that breaks webpack with optional dependencies\r\n\r\nimport { ImageData } from \"./index\";\r\nimport { clearPngColorspace } from \"./imagedetect\";\r\n\r\ndeclare var __non_webpack_require__: any;\r\n\r\nexport function requireNodeCanvas() {\r\n\tif (typeof __non_webpack_require__ != \"undefined\") {\r\n\t\t//attempt to require sharp first, after loading canvas the module sharp fails to load\r\n\t\trequireSharp();\r\n\t\ttry {\r\n\t\t\treturn __non_webpack_require__(\"canvas\");// as typeof import(\"canvas\");\r\n\t\t} catch (e) { }\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nexport function requireSharp() {\r\n\tif (typeof __non_webpack_require__ != \"undefined\") {\r\n\t\ttry {\r\n\t\t\treturn __non_webpack_require__(\"sharp\");// as typeof import(\"sharp\");\r\n\t\t} catch (e) { }\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nexport function requireElectronCommon() {\r\n\tif (typeof __non_webpack_require__ != \"undefined\") {\r\n\t\ttry {\r\n\t\t\treturn __non_webpack_require__(\"electron/common\");\r\n\t\t} catch (e) { }\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nexport function imageDataToDrawable(buf: ImageData) {\r\n\tlet nodecnv = requireNodeCanvas();\r\n\tif (!nodecnv) { throw new Error(\"couldn't find built-in canvas or the module 'canvas'\"); }\r\n\treturn new nodecnv.ImageData(buf.data, buf.width, buf.height);\r\n}\r\n\r\nexport function createCanvas(w: number, h: number) {\r\n\tlet nodecnv = requireNodeCanvas();\r\n\tif (!nodecnv) { throw new Error(\"couldn't find built-in canvas or the module 'canvas'\"); }\r\n\treturn nodecnv.createCanvas(w, h) as any as HTMLCanvasElement;\r\n}\r\n\r\nfunction flipBGRAtoRGBA(data: Uint8ClampedArray | Uint8Array) {\r\n\tfor (let i = 0; i < data.length; i += 4) {\r\n\t\tlet tmp = data[i + 2];\r\n\t\tdata[i + 2] = data[i + 0];\r\n\t\tdata[i + 0] = tmp;\r\n\t}\r\n}\r\n\r\nexport async function imageDataToFileBytes(buf: ImageData, format: \"image/png\" | \"image/webp\", quality?: any) {\r\n\t//use the electron API if we're in electron\r\n\tvar electronCommon: any;\r\n\tvar sharp: any;\r\n\tif (electronCommon = requireElectronCommon()) {\r\n\t\tlet nativeImage = electronCommon.nativeImage;\r\n\t\t//need to copy the buffer in order to flip it without destroying the original\r\n\t\tlet bufcpy = Buffer.from(buf.data.slice(buf.data.byteOffset, buf.data.byteLength));\r\n\t\tflipBGRAtoRGBA(bufcpy);\r\n\t\tlet nativeimg = nativeImage.createFromBitmap(bufcpy, { width: buf.width, height: buf.height });\r\n\t\treturn nativeimg.toPNG();\r\n\t}\r\n\telse if (sharp = requireSharp()) {\r\n\t\tlet img = sharp(Buffer.from(buf.data.buffer), { raw: { width: buf.width, height: buf.height, channels: 4 } });\r\n\t\tif (format == \"image/png\") { img.png(); }\r\n\t\telse if (format == \"image/webp\") {\r\n\t\t\tvar opts = { quality: 80 };\r\n\t\t\tif (typeof quality == \"number\") { opts.quality = quality * 100; }\r\n\t\t\timg.webp(opts)\r\n\t\t}\r\n\t\telse { throw new Error(\"unknown image format: \" + format); }\r\n\t\treturn await img.toBuffer({ resolveWithObject: false }).buffer;\r\n\t}\r\n\tthrow new Error(\"coulnd't find build-in image compression methods or the module 'electron/common' or 'sharp'\");\r\n}\r\n\r\nexport function imageDataFromBase64(base64: string) {\r\n\treturn imageDataFromBuffer(Buffer.from(base64, \"base64\"));\r\n}\r\n\r\nexport async function imageDataFromBuffer(buffer: Uint8Array) {\r\n\tclearPngColorspace(buffer);\r\n\t//use the electron API if we're in electron\r\n\tvar electronCommon: any;\r\n\tvar nodecnv: any;\r\n\tif (electronCommon = requireElectronCommon()) {\r\n\t\tlet nativeImage = electronCommon.nativeImage;\r\n\t\tlet img = nativeImage.createFromBuffer(buffer);\r\n\t\tlet pixels = img.toBitmap();\r\n\t\tlet size = img.getSize();\r\n\t\tlet pixbuf = new Uint8ClampedArray(pixels.buffer, pixels.byteOffset, pixels.byteLength);\r\n\t\tflipBGRAtoRGBA(pixbuf);\r\n\t\treturn new ImageData(pixbuf, size.width, size.height);\r\n\t} else if (nodecnv = requireNodeCanvas()) {\r\n\t\treturn new Promise<ImageData>((done, err) => {\r\n\t\t\tlet img = new nodecnv.Image();\r\n\t\t\timg.onerror = err;\r\n\t\t\timg.onload = () => {\r\n\t\t\t\tvar cnv = nodecnv.createCanvas(img.naturalWidth, img.naturalHeight);\r\n\t\t\t\tvar ctx = cnv.getContext(\"2d\")!;\r\n\t\t\t\tctx.drawImage(img, 0, 0);\r\n\t\t\t\tvar data = ctx.getImageData(0, 0, img.naturalWidth, img.naturalHeight);\r\n\t\t\t\t//use our own class\r\n\t\t\t\tdone(new ImageData(data.data, data.width, data.height));\r\n\t\t\t}\r\n\t\t\timg.src = Buffer.from(buffer.buffer, buffer.byteOffset, buffer.byteLength);\r\n\t\t});\r\n\t}\r\n\tthrow new Error(\"couldn't find built-in canvas, module 'electron/common' or the module 'canvas'\");\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import * as a1lib from \"./index\";\r\nimport * as nodeimports from \"./nodepolyfill\";\r\n\r\ndeclare global {\r\n\tinterface ImageData {\r\n\t\tputImageData(buf: ImageData, cx: number, cy: number): void;\r\n\t\tpixelOffset(x: number, y: number): number;\r\n\t\tgetPixelHash(rect: a1lib.RectLike): number;\r\n\r\n\t\tclone(rect: a1lib.RectLike): ImageData;\r\n\r\n\t\tshow: {\r\n\t\t\t(x?: number, y?: number, zoom?: number): HTMLCanvasElement;\r\n\t\t\tmaxImages: number;\r\n\t\t}\r\n\r\n\t\ttoDrawableData(): ImageData;\r\n\t\ttoImage(rect?: a1lib.RectLike): HTMLCanvasElement;\r\n\r\n\t\tgetPixel(x: number, y: number): [number, number, number, number];\r\n\t\tgetPixelValueSum(x: number, y: number): number;\r\n\t\tgetPixelInt(x: number, y: number): number;\r\n\t\tgetColorDifference(x: number, y: number, r: number, g: number, b: number, a?: number): number;\r\n\r\n\r\n\t\tsetPixel(x: number, y: number, color: [number, number, number, number]): void;\r\n\t\tsetPixel(x: number, y: number, r: number, g: number, b: number, a: number): void;\r\n\r\n\t\tsetPixelInt(x: number, y: number, color: number): void;\r\n\r\n\t\ttoFileBytes(format: \"image/png\" | \"image/webp\", quality?: any): Promise<Uint8Array>;\r\n\t\ttoPngBase64(): string;\r\n\r\n\t\tpixelCompare(buf: ImageData, x?: number, y?: number, max?: number): number;\r\n\r\n\t\tcopyTo(target: ImageData, sourcex: number, sourcey: number, width: number, height: number, targetx: number, targety: number): void;\r\n\t}\r\n\r\n\tinterface HTMLImageElement {\r\n\t\ttoBuffer(x?: number, y?: number, w?: number, h?: number): ImageData;\r\n\t\ttoCanvas(x?: number, y?: number, w?: number, h?: number): HTMLCanvasElement;\r\n\t}\r\n}\r\n\r\ntype ImageDataConstr = {\r\n\tprototype: ImageData;\r\n\tnew(width: number, height: number): ImageData;\r\n\tnew(array: Uint8ClampedArray, width: number, height: number): ImageData;\r\n};\r\n\r\n\r\n//export this so node.js can also use it\r\nexport var ImageData: ImageDataConstr;\r\n\r\n// //TODO revamp this madness a bit?\r\n// (function () {\r\n// \tvar globalvar = (typeof self != \"undefined\" ? self : (typeof (global as any) != \"undefined\" ? (global as any) : null)) as any;\r\n// \t//use the node-canvas version when on node\r\n// \tif (typeof globalvar.ImageData == \"undefined\") {\r\n// \t\tlet nodecnv = requireNodeCanvas();\r\n// \t\tglobalvar.ImageData = nodecnv.ImageData;\r\n// \t}\r\n// \tvar fill = typeof globalvar.ImageData == \"undefined\";\r\n\r\n// \t//should never be reach anymore\r\n// \tvar constr = function (this: any) {\r\n// \t\tvar i = 0;\r\n// \t\tvar data = (arguments[i] instanceof Uint8ClampedArray ? arguments[i++] : null);\r\n// \t\tvar width = arguments[i++];\r\n// \t\tvar height = arguments[i++];\r\n\r\n// \t\tif (fill) {\r\n// \t\t\tif (!data) { data = new Uint8ClampedArray(width * height * 4); }\r\n// \t\t\tthis.width = width;\r\n// \t\t\tthis.height = height;\r\n// \t\t\tthis.data = data;\r\n// \t\t}\r\n// \t\telse if (oldconstr) {\r\n// \t\t\treturn (data ? new oldconstr(data, width, height) : new oldconstr(width, height));\r\n// \t\t} else {\r\n// \t\t\tvar canvas = document.createElement('canvas');\r\n// \t\t\tcanvas.width = width;\r\n// \t\t\tcanvas.height = height;\r\n// \t\t\tvar ctx = canvas.getContext(\"2d\")!;\r\n// \t\t\tvar imageData = ctx.createImageData(width, height);\r\n// \t\t\tif (data) { imageData.data.set(data); }\r\n// \t\t\treturn imageData;\r\n// \t\t}\r\n// \t}\r\n\r\n// \tvar oldconstr = globalvar.ImageData;\r\n// \tif (typeof document != \"undefined\") {\r\n// \t\ttry {\r\n// \t\t\tnew oldconstr(1, 1);\r\n// \t\t} catch (e) {\r\n// \t\t\t//direct constructor call not allowed in ie\r\n// \t\t\toldconstr = null;\r\n// \t\t}\r\n// \t}\r\n\r\n// \tif (!fill) { constr.prototype = globalvar.ImageData.prototype; }\r\n// \tglobalvar.ImageData = constr;\r\n// \tImageData = constr as any;\r\n// })();\r\n\r\n\r\n(function () {\r\n\tvar globalvar = (typeof self != \"undefined\" ? self : (typeof (global as any) != \"undefined\" ? (global as any) : null)) as any;\r\n\tvar filltype = typeof globalvar.ImageData == \"undefined\" || typeof globalvar.document == \"undefined\";\r\n\tvar fillconstr = filltype;\r\n\tif (!filltype) {\r\n\t\tvar oldconstr = globalvar.ImageData;\r\n\t\ttry {\r\n\t\t\tlet data = new Uint8ClampedArray(4);\r\n\t\t\tdata[0] = 1;\r\n\t\t\tlet a = new globalvar.ImageData(data, 1, 1);\r\n\t\t\tfillconstr = a.data[0] != 1;\r\n\t\t} catch (e) {\r\n\t\t\tfillconstr = true;\r\n\t\t}\r\n\t}\r\n\r\n\tif (fillconstr) {\r\n\t\tvar constr = function ImageDataShim(this: any) {\r\n\t\t\tvar i = 0;\r\n\t\t\tvar data = (arguments[i] instanceof Uint8ClampedArray ? arguments[i++] : null);\r\n\t\t\tvar width = arguments[i++];\r\n\t\t\tvar height = arguments[i++];\r\n\r\n\t\t\tif (filltype) {\r\n\t\t\t\tif (!data) { data = new Uint8ClampedArray(width * height * 4); }\r\n\t\t\t\tthis.width = width;\r\n\t\t\t\tthis.height = height;\r\n\t\t\t\tthis.data = data;\r\n\t\t\t}\r\n\t\t\telse if (fillconstr) {\r\n\t\t\t\t//WARNING This branch of code does not use the same pixel data backing store\r\n\t\t\t\t//(problem with wasm, however all wasm browser have a native constructor (unless asm.js is used))\r\n\t\t\t\tvar canvas = document.createElement('canvas');\r\n\t\t\t\tcanvas.width = width;\r\n\t\t\t\tcanvas.height = height;\r\n\t\t\t\tvar ctx = canvas.getContext(\"2d\")!;\r\n\t\t\t\tvar imageData = ctx.createImageData(width, height);\r\n\t\t\t\tif (data) { imageData.data.set(data); }\r\n\t\t\t\treturn imageData;\r\n\t\t\t}\r\n\t\t\t// else {\r\n\t\t\t// \t//oh no...\r\n\t\t\t// \t//we need this monstrocity in order to call the native constructor with variable number of args\r\n\t\t\t// \t//when es5 transpile is enable (that strips the spread operator)\r\n\t\t\t// \treturn new (Function.prototype.bind.apply(oldconstr, [null,...arguments]));\r\n\t\t\t// }\r\n\t\t}\r\n\t\tif (!filltype) { constr.prototype = globalvar.ImageData.prototype; }\r\n\t\tglobalvar.ImageData = constr;\r\n\t\tImageData = constr as any;\r\n\t} else {\r\n\t\tImageData = globalvar.ImageData;\r\n\t}\r\n})();\r\n\r\n//Recast into a drawable imagedata class on all platforms, into a normal browser ImageData on browsers or a node-canvas imagedata on nodejs\r\nImageData.prototype.toDrawableData = function () {\r\n\tif (typeof document == \"undefined\") {\r\n\t\treturn nodeimports.imageDataToDrawable(this);\r\n\t} else {\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\nImageData.prototype.putImageData = function (buf, cx, cy) {\r\n\tfor (var dx = 0; dx < buf.width; dx++) {\r\n\t\tfor (var dy = 0; dy < buf.height; dy++) {\r\n\t\t\tvar i1 = (dx + cx) * 4 + (dy + cy) * 4 * this.width;\r\n\t\t\tvar i2 = dx * 4 + dy * 4 * buf.width;\r\n\t\t\tthis.data[i1] = buf.data[i2];\r\n\t\t\tthis.data[i1 + 1] = buf.data[i2 + 1];\r\n\t\t\tthis.data[i1 + 2] = buf.data[i2 + 2];\r\n\t\t\tthis.data[i1 + 3] = buf.data[i2 + 3];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nImageData.prototype.pixelOffset = function (x, y) {\r\n\treturn x * 4 + y * this.width * 4;\r\n}\r\n\r\n//creates a hash of a portion of the buffer used to check for changes\r\nImageData.prototype.getPixelHash = function (rect) {\r\n\tif (!rect) { rect = new a1lib.Rect(0, 0, this.width, this.height); }\r\n\tvar hash = 0;\r\n\tfor (var x = rect.x; x < rect.x + rect.width; x++) {\r\n\t\tfor (var y = rect.y; y < rect.y + rect.height; y++) {\r\n\t\t\tvar i = x * 4 + y * 4 * this.width;\r\n\r\n\t\t\thash = (((hash << 5) - hash) + this.data[i]) | 0;\r\n\t\t\thash = (((hash << 5) - hash) + this.data[i + 1]) | 0;\r\n\t\t\thash = (((hash << 5) - hash) + this.data[i + 2]) | 0;\r\n\t\t\thash = (((hash << 5) - hash) + this.data[i + 3]) | 0;\r\n\t\t}\r\n\t}\r\n\treturn hash;\r\n}\r\n\r\nImageData.prototype.clone = function (rect) {\r\n\treturn this.toImage(rect).getContext(\"2d\")!.getImageData(0, 0, rect.width, rect.height);\r\n}\r\n\r\nImageData.prototype.show = function (this: ImageData, x = 5, y = 5, zoom = 1) {\r\n\tif (typeof document == \"undefined\") {\r\n\t\tconsole.error(\"need a document to show an imagedata object\");\r\n\t\treturn;\r\n\t}\r\n\tvar imgs = document.getElementsByClassName(\"debugimage\");\r\n\twhile (imgs.length > ImageData.prototype.show.maxImages) { imgs[0].remove(); }\r\n\tvar el = this.toImage();\r\n\tel.classList.add(\"debugimage\")\r\n\tel.style.position = \"absolute\";\r\n\tel.style.zIndex = \"1000\";\r\n\tel.style.left = x / zoom + \"px\";\r\n\tel.style.top = y / zoom + \"px\";\r\n\tel.style.background = \"purple\";\r\n\tel.style.cursor = \"pointer\";\r\n\tel.style.imageRendering = \"pixelated\";\r\n\tel.style.outline = \"1px solid #0f0\";\r\n\tel.style.width = (this.width == 1 ? 100 : this.width) + \"px\";\r\n\tel.style.height = (this.height == 1 ? 100 : this.height) + \"px\";\r\n\tel.style.zoom = \"\" + zoom;\r\n\tel.onclick = function () { el.remove(); }\r\n\tdocument.body.appendChild(el);\r\n\treturn el;\r\n} as typeof ImageData[\"prototype\"][\"show\"];\r\nImageData.prototype.show.maxImages = 10;\r\n\r\nImageData.prototype.toImage = function (this: ImageData, rect?) {\r\n\tif (!rect) { rect = new a1lib.Rect(0, 0, this.width, this.height); }\r\n\tif (typeof document != \"undefined\") {\r\n\t\tvar el = document.createElement(\"canvas\");\r\n\t\tel.width = rect.width;\r\n\t\tel.height = rect.height;\r\n\t} else {\r\n\t\tel = nodeimports.createCanvas(rect.width, rect.height);\r\n\t}\r\n\tvar ctx = el.getContext(\"2d\")!;\r\n\tctx.putImageData(this.toDrawableData(), -rect.x, -rect.y);\r\n\treturn el;\r\n}\r\n\r\nImageData.prototype.getPixel = function (x, y): [number, number, number, number] {\r\n\tvar i = x * 4 + y * 4 * this.width;\r\n\treturn [this.data[i], this.data[i + 1], this.data[i + 2], this.data[i + 3]];\r\n}\r\n\r\nImageData.prototype.getPixelValueSum = function (x, y) {\r\n\tvar i = x * 4 + y * 4 * this.width;\r\n\treturn this.data[i] + this.data[i + 1] + this.data[i + 2];\r\n}\r\n\r\nImageData.prototype.getPixelInt = function (x, y) {\r\n\tvar i = x * 4 + y * 4 * this.width;\r\n\treturn (this.data[i + 3] << 24) + (this.data[i + 0] << 16) + (this.data[i + 1] << 8) + (this.data[i + 2] << 0);\r\n}\r\n\r\nImageData.prototype.getColorDifference = function (x, y, r, g, b, a = 255) {\r\n\tvar i = x * 4 + y * 4 * this.width;\r\n\treturn Math.abs(this.data[i] - r) + Math.abs(this.data[i + 1] - g) + Math.abs(this.data[i + 2] - b) * a / 255;\r\n}\r\n\r\nImageData.prototype.setPixel = function (x, y, ...color) {\r\n\tvar r, g, b, a;\r\n\tvar [r, g, b, a] = (Array.isArray(color[0]) ? color[0] : color);\r\n\tvar i = x * 4 + y * 4 * this.width;\r\n\tthis.data[i] = r;\r\n\tthis.data[i + 1] = g;\r\n\tthis.data[i + 2] = b;\r\n\tthis.data[i + 3] = a == undefined ? 255 : a;\r\n}\r\n\r\nImageData.prototype.setPixelInt = function (x, y, color) {\r\n\tvar i = x * 4 + y * 4 * this.width;\r\n\tthis.data[i] = (color >> 24) & 0xff;\r\n\tthis.data[i + 1] = (color >> 16) & 0xff;\r\n\tthis.data[i + 2] = (color >> 8) & 0xff;\r\n\tthis.data[i + 3] = (color >> 0) & 0xff;\r\n}\r\n\r\nImageData.prototype.toFileBytes = function (this: ImageData, format: \"image/png\" | \"image/webp\", quality?: any) {\r\n\tif (typeof HTMLCanvasElement != \"undefined\") {\r\n\t\treturn new Promise<ArrayBuffer>(d => this.toImage().toBlob(b => {\r\n\t\t\tvar r = new FileReader();\r\n\t\t\tr.readAsArrayBuffer(b!);\r\n\t\t\tr.onload = () => d(new Uint8Array(r.result as ArrayBuffer));\r\n\t\t}, format, quality));\r\n\t} else {\r\n\t\treturn nodeimports.imageDataToFileBytes(this, format, quality);\r\n\t}\r\n}\r\n\r\nImageData.prototype.toPngBase64 = function (this: ImageData) {\r\n\tif (typeof HTMLCanvasElement != \"undefined\") {\r\n\t\tvar str = this.toImage().toDataURL(\"image/png\");\r\n\t\treturn str.slice(str.indexOf(\",\") + 1);\r\n\t} else {\r\n\t\tthrow new Error(\"synchronous image conversion not supported in nodejs, try using ImageData.prototype.toFileBytes\");\r\n\t}\r\n}\r\n\r\nImageData.prototype.pixelCompare = function (buf: ImageData, x = 0, y = 0, max?: number) {\r\n\treturn a1lib.ImageDetect.simpleCompare(this, buf, x, y, max);\r\n}\r\n\r\nImageData.prototype.copyTo = function (target: ImageData, sourcex: number, sourcey: number, width: number, height: number, targetx: number, targety: number) {\r\n\t//convince v8 that these are 31bit uints\r\n\tconst targetwidth = target.width | 0;\r\n\tconst thiswidth = this.width | 0;\r\n\r\n\tconst copywidth = width | 0;\r\n\tconst fastwidth = Math.floor(width / 4) * 4;\r\n\tconst thisdata = new Int32Array(this.data.buffer, this.data.byteOffset, this.data.byteLength / 4);\r\n\tconst targetdata = new Int32Array(target.data.buffer, target.data.byteOffset, target.data.byteLength / 4);\r\n\tfor (let cy = 0; cy < height; cy++) {\r\n\t\tlet cx = 0;\r\n\t\tlet it = (cx + targetx) + (cy + targety) * targetwidth;\r\n\t\tlet is = (cx + sourcex) + (cy + sourcey) * thiswidth;\r\n\t\t//copy 4 pixels per iter (xmm)\r\n\t\tfor (; cx < fastwidth; cx += 4) {\r\n\t\t\ttargetdata[it] = thisdata[is];\r\n\t\t\ttargetdata[it + 1] = thisdata[is + 1];\r\n\t\t\ttargetdata[it + 2] = thisdata[is + 2];\r\n\t\t\ttargetdata[it + 3] = thisdata[is + 3];\r\n\t\t\tit += 4;\r\n\t\t\tis += 4;\r\n\t\t}\r\n\t\t//copy remainder per pixel\r\n\t\tfor (; cx < copywidth; cx++) {\r\n\t\t\ttargetdata[it] = thisdata[is];\r\n\t\t\tit += 1;\r\n\t\t\tis += 1;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nif (typeof HTMLImageElement != \"undefined\") {\r\n\tHTMLImageElement.prototype.toBuffer = function (this: HTMLImageElement, x = 0, y = 0, w = this.width, h = this.height) {\r\n\t\tvar cnv = document.createElement(\"canvas\");\r\n\t\tcnv.width = w;\r\n\t\tcnv.height = h;\r\n\t\tvar ctx = cnv.getContext(\"2d\")!;\r\n\t\tctx.drawImage(this, -x, -y);\r\n\t\treturn ctx.getImageData(0, 0, w, h);\r\n\t}\r\n\r\n\tHTMLImageElement.prototype.toCanvas = function (this: HTMLImageElement, x = 0, y = 0, w = this.width, h = this.height) {\r\n\t\tvar cnv = document.createElement(\"canvas\");\r\n\t\tcnv.width = w;\r\n\t\tcnv.height = h;\r\n\t\tvar ctx = cnv.getContext(\"2d\")!;\r\n\t\tctx.drawImage(this, -x, -y);\r\n\t\treturn cnv;\r\n\t}\r\n}","import * as ImageDetect from \"./imagedetect\";\r\nimport Rect, { RectLike } from \"./rect\";\r\nimport { ImgRefBind, ImgRefCtx, ImgRefData, ImgRef } from \"./imgref\";\r\nimport { ImageData } from \"./imagedata-extensions\";\r\nimport \"./alt1api\";\r\n\r\ndeclare global {\r\n\tnamespace alt1 {\r\n\t\tvar events: { [event: string]: Alt1EventHandler[] };\r\n\r\n\t\t//extension api\r\n\t\tconst capture: undefined | ((x: number, y: number, w: number, h: number) => Uint8ClampedArray);\r\n\t\tconst captureAsync: undefined | ((x: number, y: number, w: number, h: number) => Promise<Uint8ClampedArray>);\r\n\t\tconst captureMultiAsync: undefined | (<T extends { [id: string]: RectLike | null | undefined }>(areas: T) => Promise<{ [key in keyof T]: Uint8ClampedArray }>);\r\n\t\tconst bindGetRegionBuffer: undefined | ((id: number, x: number, y: number, width: number, height: number) => Uint8ClampedArray)\r\n\t}\r\n}\r\n\r\n/**\r\n * Thrown when a method is called that can not be used outside of Alt1\r\n */\r\nexport class NoAlt1Error extends Error {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.message = \"This method can not be ran outside of Alt1\";\r\n\t}\r\n};\r\n/**\r\n * Thrown when the Alt1 API returns an invalid result\r\n * Errors of a different type are throw when internal Alt1 errors occur\r\n */\r\nexport class Alt1Error extends Error { }\r\n\r\n/**\r\n * The latest Alt1 version\r\n */\r\nexport var newestversion = \"1.5.5\";\r\n\r\n/**\r\n * Whether the Alt1 API is available\r\n */\r\nexport var hasAlt1 = (typeof alt1 != \"undefined\");\r\n\r\n/**\r\n * The name of the Alt1 interface skin. (Always \"default\" if running in a browser)\r\n */\r\nexport var skinName = hasAlt1 ? alt1.skinName : \"default\";\r\n\r\n/**\r\n * Max number of bytes that can be sent by alt1 in one function\r\n * Not completely sure why this number is different than window.alt1.maxtranfer\r\n */\r\nvar maxtransfer = 4000000;\r\n\r\n/**\r\n * Open a link in the default browser\r\n * @deprecated use window.open instead\r\n */\r\nexport function openbrowser(url: string) {\r\n\tif (hasAlt1) {\r\n\t\talt1.openBrowser(url);\r\n\t}\r\n\telse {\r\n\t\twindow.open(url, '_blank');\r\n\t}\r\n}\r\n\r\n/**\r\n * Throw if Alt1 API is not available\r\n */\r\nexport function requireAlt1() {\r\n\tif (!hasAlt1) { throw new NoAlt1Error(); }\r\n}\r\n\r\n/**\r\n * Returns an object with a rectangle that spans all screens\r\n */\r\nexport function getdisplaybounds() {\r\n\tif (!hasAlt1) { return false; }\r\n\treturn new Rect(alt1.screenX, alt1.screenY, alt1.screenWidth, alt1.screenHeight);\r\n}\r\n\r\n/**\r\n * gets an imagebuffer with pixel data about the requested region\r\n */\r\nexport function capture(...args: [rect: RectLike] | [x: number, y: number, w: number, h: number]) {\r\n\t//TODO change null return on error into throw instead (x3)\r\n\tif (!hasAlt1) { throw new NoAlt1Error(); }\r\n\tvar rect = Rect.fromArgs(...args);\r\n\r\n\tif (alt1.capture) {\r\n\t\treturn new ImageData(alt1.capture(rect.x, rect.y, rect.width, rect.height), rect.width, rect.height);\r\n\t}\r\n\tvar buf = new ImageData(rect.width, rect.height);\r\n\r\n\tif (rect.width * rect.height * 4 <= maxtransfer) {\r\n\t\tvar data = alt1.getRegion(rect.x, rect.y, rect.width, rect.height);\r\n\t\tif (!data) { return null!; }\r\n\t\tdecodeImageString(data, buf, 0, 0, rect.width, rect.height);\r\n\t}\r\n\telse {\r\n\t\t//split up the request to to exceed the single transfer limit (for now)\r\n\t\tvar x1 = rect.x;\r\n\t\tvar ref = alt1.bindRegion(rect.x, rect.y, rect.width, rect.height);\r\n\t\tif (ref <= 0) { return null!; }\r\n\t\twhile (x1 < rect.x + rect.width) {\r\n\t\t\tvar x2 = Math.min(rect.x + rect.width, Math.floor(x1 + (maxtransfer / 4 / rect.height)));\r\n\t\t\tvar data = alt1.bindGetRegion(ref, x1, rect.y, x2 - x1, rect.height);\r\n\t\t\tif (!data) { return null!; }\r\n\t\t\tdecodeImageString(data, buf, x1 - rect.x, 0, x2 - x1, rect.height);\r\n\t\t\tx1 = x2;\r\n\t\t}\r\n\t}\r\n\treturn buf;\r\n}\r\n\r\n/**\r\n * Makes alt1 bind an area of the rs client in memory without sending it to the js client\r\n * returns an imgref object which can be used to get pixel data using the imgreftobuf function\r\n * currently only one bind can exist per app and the ref in (v) will always be 1\r\n */\r\nexport function captureHold(x: number, y: number, w: number, h: number) {\r\n\tx = Math.round(x); y = Math.round(y); w = Math.round(w); h = Math.round(h);\r\n\trequireAlt1();\r\n\tvar r = alt1.bindRegion(x, y, w, h);\r\n\tif (r <= 0) { throw new Alt1Error(\"capturehold failed\"); }\r\n\treturn new ImgRefBind(r, x, y, w, h);\r\n}\r\n\r\n/**\r\n * Same as captureHoldRegion, but captures the screen instead of the rs client. it also uses screen coordinates instead and can capture outside of the rs client\r\n */\r\nexport function captureHoldScreen(x: number, y: number, w: number, h: number) {\r\n\tx = Math.round(x); y = Math.round(y); w = Math.round(w); h = Math.round(h);\r\n\trequireAlt1();\r\n\tvar r = alt1.bindScreenRegion(x, y, w, h);\r\n\tif (r <= 0) { return false; }\r\n\treturn new ImgRefBind(r, x, y, w, h);\r\n}\r\n\r\n/**\r\n * bind the full rs window if the rs window can be detected by alt1, otherwise return the full screen\r\n */\r\nexport function captureHoldFullRs() {\r\n\treturn captureHold(0, 0, alt1.rsWidth, alt1.rsHeight);\r\n}\r\n\r\n/**\r\n * returns a subregion from a bound image\r\n * used internally in imgreftobuf if imgref is a bound image\r\n * @deprecated This should be handled internall by the imgrefbind.toData method\r\n */\r\nexport function transferImageData(handle: number, x: number, y: number, w: number, h: number) {\r\n\tx = Math.round(x); y = Math.round(y); w = Math.round(w); h = Math.round(h);\r\n\trequireAlt1();\r\n\r\n\tif (alt1.bindGetRegionBuffer) {\r\n\t\treturn new ImageData(alt1.bindGetRegionBuffer(handle, x, y, w, h), w, h);\r\n\t}\r\n\tvar r = new ImageData(w, h);\r\n\r\n\tvar x1 = x;\r\n\twhile (true) {//split up the request to to exceed the single transfer limit (for now)\r\n\t\tvar x2 = Math.min(x + w, Math.floor(x1 + (maxtransfer / 4 / h)));\r\n\t\tvar a = alt1.bindGetRegion(handle, x1, y, x2 - x1, h);\r\n\t\tif (!a) { throw new Alt1Error(); }\r\n\t\tdecodeImageString(a, r, x1 - x, 0, x2 - x1, h);\r\n\t\tx1 = x2;\r\n\t\tif (x1 == x + w) { break; };\r\n\t}\r\n\treturn r;\r\n}\r\n\r\n/**\r\n * decodes a returned string from alt1 to an imagebuffer\r\n */\r\nexport function decodeImageString(imagestring: string, target: ImageData, x: number, y: number, w: number, h: number) {\r\n\tvar bin = atob(imagestring);\r\n\r\n\tvar bytes = target.data;\r\n\r\n\tw |= 0;\r\n\th |= 0;\r\n\tvar offset = 4 * x + 4 * y * target.width;\r\n\tvar target_width = target.width | 0;\r\n\tfor (var a = 0; a < w; a++) {\r\n\t\tfor (var b = 0; b < h; b++) {\r\n\t\t\tvar i1 = (offset + (a * 4 | 0) + (b * target_width * 4 | 0)) | 0;\r\n\t\t\tvar i2 = ((a * 4 | 0) + (b * 4 * w | 0)) | 0;\r\n\t\t\tbytes[i1 + 0 | 0] = bin.charCodeAt(i2 + 2 | 0);//fix weird red/blue swap in c#\r\n\t\t\tbytes[i1 + 1 | 0] = bin.charCodeAt(i2 + 1 | 0);\r\n\t\t\tbytes[i1 + 2 | 0] = bin.charCodeAt(i2 + 0 | 0);\r\n\t\t\tbytes[i1 + 3 | 0] = bin.charCodeAt(i2 + 3 | 0);\r\n\t\t}\r\n\t}\r\n\treturn target;\r\n}\r\n\r\n/**\r\n * encodes an imagebuffer to a string\r\n */\r\nexport function encodeImageString(buf: ImageData, sx = 0, sy = 0, sw = buf.width, sh = buf.height) {\r\n\tvar raw = \"\";\r\n\tfor (var y = sy; y < sy + sh; y++) {\r\n\t\tfor (var x = sx; x < sx + sw; x++) {\r\n\t\t\tvar i = 4 * x + 4 * buf.width * y | 0;\r\n\t\t\traw += String.fromCharCode(buf.data[i + 2 | 0]);\r\n\t\t\traw += String.fromCharCode(buf.data[i + 1 | 0]);\r\n\t\t\traw += String.fromCharCode(buf.data[i + 0 | 0]);\r\n\t\t\traw += String.fromCharCode(buf.data[i + 3 | 0]);\r\n\t\t}\r\n\t}\r\n\treturn btoa(raw);\r\n}\r\n\r\n/**\r\n * mixes the given color into a single int. This format is used by alt1\r\n */\r\nexport function mixColor(r: number, g: number, b: number, a = 255) {\r\n\treturn (b << 0) + (g << 8) + (r << 16) + (a << 24);\r\n}\r\n\r\nexport function unmixColor(col: number): [number, number, number] {\r\n\tvar r = (col >> 16) & 0xff;\r\n\tvar g = (col >> 8) & 0xff;\r\n\tvar b = (col >> 0) & 0xff;\r\n\treturn [r, g, b];\r\n}\r\n\r\nexport function identifyApp(url: string) {\r\n\tif (hasAlt1) { alt1.identifyAppUrl(url); }\r\n}\r\n\r\nexport function resetEnvironment() {\r\n\thasAlt1 = (typeof alt1 != \"undefined\");\r\n\tskinName = hasAlt1 ? alt1.skinName : \"default\";\r\n}\r\n\r\nfunction convertAlt1Version(str: string) {\r\n\tvar a = str.match(/^(\\d+)\\.(\\d+)\\.(\\d+)$/);\r\n\tif (!a) { throw new RangeError(\"Invalid version string\"); }\r\n\treturn (+a[1]) * 1000 * 1000 + (+a[2]) * 1000 + (+a[3]) * 1;\r\n}\r\n\r\nvar cachedVersionInt = -1\r\n/**\r\n * checks if alt1 is running and at least the given version. versionstr should be a string with the version eg: 1.3.2\r\n * @param versionstr\r\n */\r\nexport function hasAlt1Version(versionstr: string) {\r\n\tif (!hasAlt1) { return false; }\r\n\tif (cachedVersionInt == -1) { cachedVersionInt = alt1.versionint; }\r\n\treturn cachedVersionInt >= convertAlt1Version(versionstr);\r\n}\r\n\r\n/**\r\n * Gets the current cursor position in the game, returns null if the rs window is not active (alt1.rsActive)\r\n */\r\nexport function getMousePosition() {\r\n\tvar pos = alt1.mousePosition;\r\n\tif (pos == -1) { return null; }\r\n\treturn { x: pos >>> 16, y: pos & 0xFFFF };\r\n}\r\n/**\r\n * Registers a given HTML element as a frame border, when this element is dragged by the user the Alt1 frame will resize accordingly\r\n * Use the direction arguements to make a given direction stick to the mouse. eg. Only set left to true to make the element behave as the left border\r\n * Or set all to true to move the whole window. Not all combinations are permitted\r\n */\r\nexport function addResizeElement(el: HTMLElement, left: boolean, top: boolean, right: boolean, bot: boolean) {\r\n\tif (!hasAlt1 || !alt1.userResize) { return; }\r\n\tel.addEventListener(\"mousedown\", function (e) {\r\n\t\talt1.userResize(left, top, right, bot);\r\n\t\te.preventDefault();\r\n\t});\r\n}\r\n\r\n\r\n\r\nexport type Alt1EventHandler = (e: any) => void;\r\n\r\n/**\r\n * Add an event listener\r\n */\r\nexport function on<K extends keyof Alt1EventType>(type: K, listener: (ev: Alt1EventType[K]) => void) {\r\n\trequireAlt1();\r\n\tif (!alt1.events) { alt1.events = {}; }\r\n\tif (!alt1.events[type]) { alt1.events[type] = []; }\r\n\talt1.events[type].push(listener);\r\n}\r\n\r\n/**\r\n * Removes an event listener\r\n */\r\nexport function removeListener<K extends keyof Alt1EventType>(type: K, listener: (ev: Alt1EventType[K]) => void) {\r\n\tvar elist = alt1.events && alt1.events[type];\r\n\tif (!elist) { return; }\r\n\tvar i = elist.indexOf(listener);\r\n\tif (i == -1) { return; }\r\n\telist.splice(i, 1);\r\n}\r\n\r\n/**\r\n * Listens for the event to fire once and then stops listening\r\n * @param event\r\n * @param cb\r\n */\r\nexport function once<K extends keyof Alt1EventType>(type: K, listener: (ev: Alt1EventType[K]) => void) {\r\n\trequireAlt1();\r\n\tvar fn = (e: Alt1EventType[K]) => {\r\n\t\tremoveListener(type, fn);\r\n\t\tlistener(e);\r\n\t};\r\n\ton(type, fn);\r\n}\r\nexport interface Alt1EventType {\r\n\t\"alt1pressed\": { eventName: \"alt1pressed\", text: string, mouseAbs: { x: number, y: number }, mouseRs: { x: number, y: number }, x: number, y: number, rsLinked: boolean },\r\n\t\"menudetected\": { eventName: \"menudetected\", rectangle: { x: number, y: number, width: number, height: number } },\r\n\t\"rslinked\": { eventName: \"rslinked\" },\r\n\t\"rsunlinked\": { eventName: \"rsunlinked\" },\r\n\t\"permissionchanged\": { eventName: \"permissionchanged\" },\r\n\t\"daemonrun\": { eventName: \"daemonrun\", result: { now: number, nextRun: number, state: string, messages: { [id: string]: { title: string, body: string } }, statusXml: string } },\r\n\t\"userevent\": { eventName: \"userevent\", argument: string },\r\n\t\"rsfocus\": { eventName: \"rsfocus\" },\r\n\t\"rsblur\": { eventName: \"rsblur\" },\r\n};\r\n\r\n/**\r\n * Used to read a set of images from a binary stream returned by the Alt1 API\r\n */\r\nexport class ImageStreamReader {\r\n\tprivate framebuffer: ImageData | null = null;\r\n\tprivate streamreader: ReadableStreamReader<Uint8Array>;\r\n\tprivate pos = 0;\r\n\tprivate reading = false;\r\n\tclosed = false;\r\n\r\n\t//paused state\r\n\tprivate pausedindex = -1;\r\n\tprivate pausedbuffer: Uint8Array | null = null;\r\n\r\n\tconstructor(reader: ReadableStreamReader<Uint8Array>, width: number, height: number);\r\n\tconstructor(reader: ReadableStreamReader<Uint8Array>, framebuffer: ImageData);\r\n\tconstructor(reader: ReadableStreamReader<Uint8Array>);\r\n\tconstructor(reader: ReadableStreamReader<Uint8Array>, ...args: any[]) {\r\n\t\tthis.streamreader = reader;\r\n\t\tif (args[0] instanceof ImageData) { this.setFrameBuffer(args[0]); }\r\n\t\telse if (typeof args[0] == \"number\") { this.setFrameBuffer(new ImageData(args[0], args[1])); }\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tsetFrameBuffer(buffer: ImageData) {\r\n\t\tif (this.reading) { throw new Error(\"can't change framebuffer while reading\"); }\r\n\t\tthis.framebuffer = buffer;\r\n\t}\r\n\r\n\t/**\r\n\t * Closes the underlying stream and ends reading\r\n\t */\r\n\tclose() {\r\n\t\tthis.streamreader.cancel();\r\n\t}\r\n\r\n\t/**\r\n\t * Reads a single image from the stream\r\n\t */\r\n\tasync nextImage() {\r\n\t\tif (this.reading) { throw new Error(\"already reading from this stream\"); }\r\n\t\tif (!this.framebuffer) { throw new Error(\"framebuffer not set\"); }\r\n\t\tthis.reading = true;\r\n\t\tvar synctime = -Date.now();\r\n\t\tvar starttime = Date.now();\r\n\t\tvar r = false;\r\n\t\twhile (!r) {\r\n\t\t\tif (this.pausedindex != -1 && this.pausedbuffer) {\r\n\t\t\t\tr = this.readChunk(this.pausedindex, this.framebuffer.data, this.pausedbuffer);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsynctime += Date.now();\r\n\t\t\t\tvar res = await this.streamreader.read();\r\n\t\t\t\tsynctime -= Date.now();\r\n\t\t\t\tif (res.done) { throw new Error(\"Stream closed while reading\"); }\r\n\t\t\t\tvar data = res.value;\r\n\t\t\t\tr = this.readChunk(0, this.framebuffer.data, data);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsynctime += Date.now();\r\n\t\t//console.log(\"Decoded async image, \" + this.framebuffer.width + \"x\" + this.framebuffer.height + \" time: \" + (Date.now() - starttime) + \"ms (\" + synctime + \"ms main thread)\");\r\n\t\tthis.reading = false;\r\n\t\treturn this.framebuffer;\r\n\t}\r\n\r\n\tprivate readChunk(i: number, framedata: Uint8ClampedArray, buffer: Uint8Array) {\r\n\t\t//very hot code, explicit int32 casting with |0 speeds it up by ~ x2\r\n\t\ti = i | 0;\r\n\t\tvar framesize = framedata.length | 0;\r\n\t\tvar pos = this.pos;\r\n\t\tvar datalen = buffer.length | 0;\r\n\t\t//var data32 = new Float64Array(buffer.buffer);\r\n\t\t//var framedata32 = new Float64Array(framedata.buffer);\r\n\r\n\t\t//fix possible buffer misalignment\r\n\t\t//align to 16 for extra loop unrolling\r\n\t\twhile (i < datalen) {\r\n\t\t\t//slow loop, fix alignment and other issues\r\n\t\t\twhile (i < datalen && pos < framesize && (pos % 16 != 0 || !((i + 16 | 0) <= datalen && (pos + 16 | 0) <= framesize))) {\r\n\t\t\t\tvar rel = pos;\r\n\t\t\t\tif (pos % 4 == 0) { rel = rel + 2 | 0; }\r\n\t\t\t\tif (pos % 4 == 2) { rel = rel - 2 | 0; }\r\n\t\t\t\tframedata[rel | 0] = buffer[i | 0];\r\n\t\t\t\ti = i + 1 | 0;\r\n\t\t\t\tpos = pos + 1 | 0;\r\n\t\t\t}\r\n\r\n\t\t\t//fast unrolled loop for large chunks i wish js had some sort of memcpy\r\n\t\t\tif (pos % 16 == 0) {\r\n\t\t\t\twhile ((i + 16 | 0) <= datalen && (pos + 16 | 0) <= framesize) {\r\n\t\t\t\t\tframedata[pos + 0 | 0] = buffer[i + 2 | 0];\r\n\t\t\t\t\tframedata[pos + 1 | 0] = buffer[i + 1 | 0];\r\n\t\t\t\t\tframedata[pos + 2 | 0] = buffer[i + 0 | 0];\r\n\t\t\t\t\tframedata[pos + 3 | 0] = buffer[i + 3 | 0];\r\n\r\n\t\t\t\t\tframedata[pos + 4 | 0] = buffer[i + 6 | 0];\r\n\t\t\t\t\tframedata[pos + 5 | 0] = buffer[i + 5 | 0];\r\n\t\t\t\t\tframedata[pos + 6 | 0] = buffer[i + 4 | 0];\r\n\t\t\t\t\tframedata[pos + 7 | 0] = buffer[i + 7 | 0];\r\n\r\n\t\t\t\t\tframedata[pos + 8 | 0] = buffer[i + 10 | 0];\r\n\t\t\t\t\tframedata[pos + 9 | 0] = buffer[i + 9 | 0];\r\n\t\t\t\t\tframedata[pos + 10 | 0] = buffer[i + 8 | 0];\r\n\t\t\t\t\tframedata[pos + 11 | 0] = buffer[i + 11 | 0];\r\n\r\n\t\t\t\t\tframedata[pos + 12 | 0] = buffer[i + 14 | 0];\r\n\t\t\t\t\tframedata[pos + 13 | 0] = buffer[i + 13 | 0];\r\n\t\t\t\t\tframedata[pos + 14 | 0] = buffer[i + 12 | 0];\r\n\t\t\t\t\tframedata[pos + 15 | 0] = buffer[i + 15 | 0];\r\n\r\n\t\t\t\t\t//could speed it up another x2 but wouldn't be able to swap r/b swap and possible alignment issues\r\n\t\t\t\t\t//framedata32[pos / 8 + 0 | 0] = data32[i / 8 + 0 | 0];\r\n\t\t\t\t\t//framedata32[pos / 8 + 1 | 0] = data32[i / 8 + 1 | 0];\r\n\t\t\t\t\t//framedata32[pos / 4 + 2 | 0] = data32[i / 4 + 2 | 0];\r\n\t\t\t\t\t//framedata32[pos / 4 + 3 | 0] = data32[i / 4 + 3 | 0];\r\n\r\n\t\t\t\t\tpos = pos + 16 | 0;\r\n\t\t\t\t\ti = i + 16 | 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (pos >= framesize) {\r\n\t\t\t\tthis.pausedbuffer = null;\r\n\t\t\t\tthis.pausedindex = -1;\r\n\r\n\t\t\t\tthis.pos = 0;\r\n\t\t\t\tif (i != buffer.length - 1) {\r\n\t\t\t\t\tthis.pausedbuffer = buffer;\r\n\t\t\t\t\tthis.pausedindex = i;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.pos = pos;\r\n\t\tthis.pausedbuffer = null;\r\n\t\tthis.pausedindex = -1;\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n/**\r\n * Asynchronously captures a section of the game screen\r\n */\r\nexport async function captureAsync(...args: [rect: RectLike] | [x: number, y: number, width: number, height: number]) {\r\n\trequireAlt1();\r\n\tvar rect = Rect.fromArgs(...args);\r\n\tif (alt1.captureAsync) {\r\n\t\tlet img = await alt1.captureAsync(rect.x, rect.y, rect.width, rect.height);\r\n\t\treturn new ImageData(img, rect.width, rect.height);\r\n\t}\r\n\r\n\tif (!hasAlt1Version(\"1.4.6\")) {\r\n\t\treturn capture(rect.x, rect.y, rect.width, rect.height);\r\n\t}\r\n\tvar url = \"https://alt1api/pixel/getregion/\" + encodeURIComponent(JSON.stringify({ ...rect, format: \"raw\", quality: 1 }));\r\n\tvar res = await fetch(url);\r\n\tvar imgreader = new ImageStreamReader(res.body!.getReader(), rect.width, rect.height);\r\n\treturn imgreader.nextImage();\r\n}\r\n\r\n/**\r\n * Asynchronously captures multple area's. This method captures the images in the same render frame if possible\r\n * @param areas \r\n */\r\nexport async function captureMultiAsync<T extends { [id: string]: RectLike | null | undefined }>(areas: T) {\r\n\trequireAlt1();\r\n\tvar r = {} as { [K in keyof T]: ImageData | null };\r\n\tif (alt1.captureMultiAsync) {\r\n\t\tlet bufs = await alt1.captureMultiAsync(areas);\r\n\t\tfor (let a in areas) {\r\n\t\t\tif (!bufs[a]) { r[a] = null; }\r\n\t\t\tr[a] = new ImageData(bufs[a], areas[a]!.width, areas[a]!.height);\r\n\t\t}\r\n\t\treturn r;\r\n\t}\r\n\r\n\tvar capts = [] as RectLike[];\r\n\tvar captids = [] as (keyof T)[];\r\n\tfor (var id in areas) {\r\n\t\tif (areas[id]) { capts.push(areas[id]!); captids.push(id); }\r\n\t\telse { r[id] = null; }\r\n\t}\r\n\tif (capts.length == 0) { return r; }\r\n\tif (!hasAlt1Version(\"1.5.1\")) {\r\n\t\tvar proms = [] as Promise<ImageData | null>[];\r\n\t\tfor (var a = 0; a < capts.length; a++) { proms.push(captureAsync(capts[a])); }\r\n\t\tvar results = await Promise.all(proms);\r\n\t\tfor (var a = 0; a < capts.length; a++) { r[captids[a]] = results[a]; }\r\n\t} else {\r\n\t\tvar res = await fetch(\"https://alt1api/pixel/getregionmulti/\" + encodeURIComponent(JSON.stringify({ areas: capts, format: \"raw\", quality: 1 })));\r\n\t\tvar imgreader = new ImageStreamReader(res.body!.getReader());\r\n\t\tfor (var a = 0; a < capts.length; a++) {\r\n\t\t\tvar capt = capts[a];\r\n\t\t\timgreader.setFrameBuffer(new ImageData(capt.width, capt.height));\r\n\t\t\tr[captids[a]] = await imgreader.nextImage();\r\n\t\t}\r\n\t}\r\n\treturn r;\r\n}\r\n\r\nexport type CaptureStreamResult = { x: number, y: number, width: number, height: number, framenr: number, close: () => void, closed: boolean };\r\n\r\n/**\r\n * Starts capturing a realtime stream of the game. Make sure you keep reading the stream and close it when you're done or Alt1 WILL crash\r\n * @param framecb Called whenever a new frame is decoded\r\n * @param errorcb Called whenever an error occurs, the error is rethrown if not defined\r\n * @param fps Maximum fps of the stream\r\n */\r\nexport function captureStream(x: number, y: number, width: number, height: number, fps: number, framecb: (img: ImageData) => void, errorcb?: (e: Error) => void): CaptureStreamResult {\r\n\trequireAlt1();\r\n\tif (!hasAlt1Version(\"1.4.6\")) { throw new Alt1Error(\"This function is not supported in this version of Alt1\"); }\r\n\tvar url = \"https://alt1api/pixel/streamregion/\" + encodeURIComponent(JSON.stringify({ x, y, width, height, fps, format: \"raw\" }));\r\n\tvar res = fetch(url).then(async res => {\r\n\t\tvar reader = new ImageStreamReader(res.body!.getReader(), width, height);\r\n\t\ttry {\r\n\t\t\twhile (!reader.closed && !state.closed) {\r\n\t\t\t\tvar img = await reader.nextImage();\r\n\t\t\t\tif (!state.closed) {\r\n\t\t\t\t\tframecb(img);\r\n\t\t\t\t\tstate.framenr++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tif (!state.closed) {\r\n\t\t\t\treader.close();\r\n\t\t\t\tif (errorcb) { errorcb(e); }\r\n\t\t\t\telse { throw e; }\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!reader.closed && state.closed) {\r\n\t\t\treader.close();\r\n\t\t}\r\n\t});\r\n\tvar state = {\r\n\t\tx, y, width, height,\r\n\t\tframenr: 0,\r\n\t\tclose: () => { state.closed = true; },\r\n\t\tclosed: false,\r\n\t};\r\n\treturn state;\r\n}\r\n","import { ImgRef, ImgRefBind } from \"./imgref\";\r\nimport * as wapper from \"./wrapper\";\r\nimport * as nodeimports from \"./nodepolyfill\";\r\nimport { RectLike, Rect } from \".\";\r\n\r\n/**\r\n* Downloads an image and returns the ImageData\r\n* Make sure the png image does not have a sRGB chunk or the resulting pixels will differ for different users!!!\r\n* @param url http(s) or data url to the image\r\n*/\r\nexport async function imageDataFromUrl(url: string): Promise<ImageData> {\r\n\tif (typeof Image != \"undefined\") {\r\n\t\tvar img = new Image();\r\n\t\timg.crossOrigin = \"crossorigin\";\r\n\t\treturn await new Promise((done, fail) => {\r\n\t\t\timg.onload = function () { done(img.toBuffer()); };\r\n\t\t\timg.onerror = fail;\r\n\t\t\timg.src = url;\r\n\t\t}) as ImageData;\r\n\t} else {\r\n\t\tvar hdr = \"data:image/png;base64,\";\r\n\t\tif (url.startsWith(hdr)) {\r\n\t\t\treturn imageDataFromBase64(url.slice(hdr.length));\r\n\t\t}\r\n\t\tthrow new Error(\"loading remote images in nodejs has been disabled, load the raw bytes and use imageDataFromNodeBuffer instead\");\r\n\t}\r\n}\r\n\r\n/**\r\n* Loads an ImageData object from a base64 encoded png image\r\n* Make sure the png image does not have a sRGB chunk or the resulting pixels will differ for different users!!!\r\n* @param data a base64 encoded png image\r\n*/\r\nexport async function imageDataFromBase64(data: string) {\r\n\tif (typeof Image != \"undefined\") {\r\n\t\treturn imageDataFromUrl(\"data:image/png;base64,\" + data);\r\n\t} else {\r\n\t\treturn nodeimports.imageDataFromBase64(data);\r\n\t}\r\n}\r\n\r\n/**\r\n * Loads an ImageData object directly from a png encoded file buffer\r\n * This method ensures that png color space headers are taken care off\r\n * @param data The bytes of a png file\r\n */\r\nexport async function imageDataFromFileBuffer(data: Uint8Array) {\r\n\tclearPngColorspace(data);\r\n\tif (typeof Image != \"undefined\") {\r\n\t\tlet blob = new Blob([data], { type: \"image/png\" });\r\n\t\tlet url = URL.createObjectURL(blob);\r\n\t\tlet r = await imageDataFromUrl(url);\r\n\t\tURL.revokeObjectURL(url);\r\n\t\treturn r;\r\n\t} else {\r\n\t\treturn nodeimports.imageDataFromBuffer(data);\r\n\t}\r\n}\r\n\r\n/**\r\n* Checks if a given byte array is a png file (by checking for ?PNG as first 4 bytes)\r\n* @param bytes Raw bytes of the png file\r\n*/\r\nexport function isPngBuffer(bytes: Uint8Array) {\r\n\treturn bytes[0] == 137 && bytes[1] == 80 && bytes[2] == 78 && bytes[3] == 71;\r\n}\r\n/**\r\n* Resets the colorspace data in the png file.\r\n* This makes sure the browser renders the exact colors in the file instead of filtering it in order to obtain the best real life representation of\r\n* what it looked like on the authors screen. (this feature is often broken and not supported)\r\n* For example a round trip printscreen -> open in browser results in different colors than the original\r\n* @param data Raw bytes of the png file\r\n*/\r\nexport function clearPngColorspace(data: Uint8Array) {\r\n\tif (!isPngBuffer(data)) { throw new Error(\"non-png image received\"); }\r\n\tvar i = 8;\r\n\twhile (i < data.length) {\r\n\t\tvar length = data[i++] * 0x1000000 + data[i++] * 0x10000 + data[i++] * 0x100 + data[i++];\r\n\t\tvar ancillary = !!((data[i] >> 5) & 1);\r\n\t\tvar chunkname = String.fromCharCode(data[i], data[i + 1], data[i + 2], data[i + 3]);\r\n\t\tvar chunkid = chunkname.toLowerCase();\r\n\t\tif (chunkid != \"trns\" && ancillary) {\r\n\t\t\tdata[i + 0] = \"n\".charCodeAt(0);\r\n\t\t\tdata[i + 1] = \"o\".charCodeAt(0);\r\n\t\t\tdata[i + 2] = \"P\".charCodeAt(0);\r\n\t\t\tdata[i + 3] = \"E\".charCodeAt(0);\r\n\r\n\t\t\t//calculate new chunk checksum\r\n\t\t\t//http://www.libpng.org/pub/png/spec/1.2/PNG-CRCAppendix.html\r\n\t\t\tvar end = i + 4 + length;\r\n\t\t\tvar crc = 0xffffffff;\r\n\r\n\t\t\t//should be fast enough like this\r\n\t\t\tvar bitcrc = function (bit: number) {\r\n\t\t\t\tfor (var k = 0; k < 8; k++) {\r\n\t\t\t\t\tif (bit & 1) { bit = 0xedb88320 ^ (bit >>> 1); }\r\n\t\t\t\t\telse { bit = bit >>> 1; }\r\n\t\t\t\t}\r\n\t\t\t\treturn bit;\r\n\t\t\t}\r\n\t\t\tfor (var a = i; a < end; a++) {\r\n\t\t\t\tif (a >= i + 4) { data[a] = 0; }\r\n\t\t\t\tvar bit = data[a];\r\n\t\t\t\tcrc = bitcrc((crc ^ bit) & 0xff) ^ (crc >>> 8);\r\n\t\t\t}\r\n\t\t\tcrc = crc ^ 0xffffffff;\r\n\t\t\t//new chunk checksum\r\n\t\t\tdata[i + 4 + length + 0] = (crc >> 24) & 0xff;\r\n\t\t\tdata[i + 4 + length + 1] = (crc >> 16) & 0xff;\r\n\t\t\tdata[i + 4 + length + 2] = (crc >> 8) & 0xff;\r\n\t\t\tdata[i + 4 + length + 3] = (crc >> 0) & 0xff;\r\n\t\t}\r\n\t\tif (chunkname == \"IEND\") { break; }\r\n\t\ti += 4;//type\r\n\t\ti += length;//data\r\n\t\ti += 4;//crc\r\n\t}\r\n}\r\n\r\n/**\r\n* finds the given needle ImageBuffer in the given haystack ImgRef this function uses the best optimized available\r\n* code depending on the type of the haystack. It will use fast c# searching if the haystack is an ImgRefBind, js searching\r\n* is used otherwise.\r\n* the checklist argument is no longer used and should ignored or null/undefined\r\n* The optional sx,sy,sw,sh arguments indicate a bounding rectangle in which to search the needle. The rectangle should be bigger than the needle\r\n* @returns An array of points where the needle is found. The array is empty if none are found\r\n*/\r\nexport function findSubimage(haystackImgref: ImgRef, needleBuffer: ImageData, sx = 0, sy = 0, sw = haystackImgref.width, sh = haystackImgref.height) {\r\n\tif (!haystackImgref) { throw new TypeError(); }\r\n\tif (!needleBuffer) { throw new TypeError(); }\r\n\r\n\tvar max = 30;\r\n\r\n\t//check if we can do this in alt1\r\n\tif (haystackImgref instanceof ImgRefBind && wapper.hasAlt1 && alt1.bindFindSubImg) {\r\n\t\tvar needlestr = wapper.encodeImageString(needleBuffer);\r\n\t\tvar r = alt1.bindFindSubImg(haystackImgref.handle, needlestr, needleBuffer.width, sx, sy, sw, sh);\r\n\t\tif (!r) { throw new wapper.Alt1Error(); }\r\n\t\treturn JSON.parse(r) as { x: number, y: number }[];\r\n\t}\r\n\r\n\treturn findSubbuffer(haystackImgref.read(), needleBuffer, sx, sy, sw, sh);\r\n}\r\n\r\n/**\r\n* Uses js to find the given needle ImageBuffer in the given haystack ImageBuffer. It is better to use the alt1.bind- functions in\r\n* combination with a1nxt.findsubimg.\r\n* the optional sx,sy,sw,sh arguments indicate a bounding rectangle in which to search.\r\n* @returns An array of points where the needle is found. The array is empty if none are found\r\n*/\r\nexport function findSubbuffer(haystack: ImageData, needle: ImageData, sx = 0, sy = 0, sw = haystack.width, sh = haystack.height) {\r\n\tvar r: { x: number, y: number }[] = [];\r\n\tvar maxdif = 30;\r\n\tvar maxresults = 50;\r\n\tvar needlestride = needle.width * 4;\r\n\tvar heystackstride = haystack.width * 4;\r\n\r\n\t//built list of non trans pixel to check\r\n\tvar checkList: { x: number, y: number }[] = [];\r\n\tfor (var y = 0; y < needle.height; y++) {\r\n\t\tfor (var x = 0; x < needle.width; x++) {\r\n\t\t\tvar i = x * 4 + y * needlestride;\r\n\t\t\tif (needle.data[i + 3] == 255) { checkList.push({ x: x, y: y }); }\r\n\t\t\tif (checkList.length == 10) { break; }\r\n\t\t}\r\n\t\tif (checkList.length == 10) { break; }\r\n\t}\r\n\r\n\tvar cw = (sx + sw) - needle.width;\r\n\tvar ch = (sy + sh) - needle.height;\r\n\tvar checklength = checkList.length;\r\n\tfor (var y = sy; y <= ch; y++) {\r\n\t\touter: for (var x = sx; x <= cw; x++) {\r\n\t\t\tfor (var a = 0; a < checklength; a++) {\r\n\t\t\t\tvar i1 = (x + checkList[a].x) * 4 + (y + checkList[a].y) * heystackstride;\r\n\t\t\t\tvar i2 = checkList[a].x * 4 + checkList[a].y * needlestride;\r\n\r\n\t\t\t\tvar d = 0;\r\n\t\t\t\td = d + Math.abs(haystack.data[i1 + 0] - needle.data[i2 + 0]) | 0;\r\n\t\t\t\td = d + Math.abs(haystack.data[i1 + 1] - needle.data[i2 + 1]) | 0;\r\n\t\t\t\td = d + Math.abs(haystack.data[i1 + 2] - needle.data[i2 + 2]) | 0;\r\n\t\t\t\td *= 255 / needle.data[i2 + 3];\r\n\t\t\t\tif (d > maxdif) {\r\n\t\t\t\t\tcontinue outer;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (simpleCompare(haystack, needle, x, y, maxdif) != Infinity) {\r\n\t\t\t\tr.push({ x, y });\r\n\t\t\t\tif (r.length > maxresults) { return r; }\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn r;\r\n}\r\n\r\n/**\r\n* Compares two images and returns the average color difference per pixel between them\r\n* @param max The max color difference at any point in the image before short circuiting the function and returning Infinity. set to -1 to always continue.\r\n* @returns The average color difference per pixel or Infinity if the difference is more than max at any point in the image\r\n*/\r\nexport function simpleCompare(bigbuf: ImageData, checkbuf: ImageData, x: number, y: number, max = 30) {\r\n\tif (x < 0 || y < 0) { throw new RangeError(); }\r\n\tif (x + checkbuf.width > bigbuf.width || y + checkbuf.height > bigbuf.height) { throw new RangeError(); }\r\n\r\n\tif (max == -1) { max = 255 * 4; }\r\n\r\n\tvar dif = 0;\r\n\tfor (var step = 8; step >= 1; step /= 2) {\r\n\t\tfor (var cx = 0; cx < checkbuf.width; cx += step) {\r\n\t\t\tfor (var cy = 0; cy < checkbuf.height; cy += step) {\r\n\t\t\t\tvar i1 = (x + cx) * 4 + (y + cy) * bigbuf.width * 4;\r\n\t\t\t\tvar i2 = cx * 4 + cy * checkbuf.width * 4;\r\n\t\t\t\tvar d = 0;\r\n\t\t\t\td = d + Math.abs(bigbuf.data[i1 + 0] - checkbuf.data[i2 + 0]) | 0;\r\n\t\t\t\td = d + Math.abs(bigbuf.data[i1 + 1] - checkbuf.data[i2 + 1]) | 0;\r\n\t\t\t\td = d + Math.abs(bigbuf.data[i1 + 2] - checkbuf.data[i2 + 2]) | 0;\r\n\t\t\t\td *= checkbuf.data[i2 + 3] / 255;\r\n\t\t\t\tif (step == 1) { dif += d; }\r\n\t\t\t\tif (d > max) { return Infinity; }\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn dif / checkbuf.width / checkbuf.height;\r\n}\r\n\r\n/**\r\n* Returns the difference between two colors (scaled to the alpha of the second color)\r\n*/\r\nexport function coldif(r1: number, g1: number, b1: number, r2: number, g2: number, b2: number, a2: number) {\r\n\treturn (Math.abs(r1 - r2) + Math.abs(g1 - g2) + Math.abs(b1 - b2)) * a2 / 255;//only applies alpha for 2nd buffer!\r\n}\r\n\r\n/**\r\n * Turns map of promises into a map that contains the resolved values after loading.\r\n * @param input\r\n */\r\nexport function asyncMap<T extends { [name: string]: Promise<any> }>(input: T) {\r\n\t//recusive types what xd\r\n\ttype subt = { [K in keyof T]: T[K] extends Promise<infer U> ? U : any };\r\n\tvar raw = {} as subt;\r\n\tvar promises: Promise<any>[] = [];\r\n\r\n\tfor (var a in input) {\r\n\t\tif (input.hasOwnProperty(a)) {\r\n\t\t\traw[a] = null!;\r\n\t\t\tpromises.push(input[a].then(function (a: keyof T, i: any) { raw[a] = i; r[a] = i; }.bind(null, a)));\r\n\t\t}\r\n\t}\r\n\tvar r = {} as subt & { promise: Promise<subt>, loaded: boolean, raw: subt };\r\n\tvar promise = Promise.all(promises).then(() => { r.loaded = true; return r; });\r\n\tObject.defineProperty(r, \"loaded\", { enumerable: false, value: false, writable: true });\r\n\tObject.defineProperty(r, \"promise\", { enumerable: false, value: promise });\r\n\tObject.defineProperty(r, \"raw\", { enumerable: false, value: raw });\r\n\treturn Object.assign(r, raw);\r\n}\r\n\r\n/**\r\n* Same as asyncMap, but casts the properties to ImageData in typescript\r\n*/\r\nexport function webpackImages<T extends { [name: string]: Promise<ImageData> }>(input: T) {\r\n\ttype subt = { [K in keyof T]: ImageData };\r\n\treturn asyncMap<{ [K in keyof T]: Promise<ImageData> }>(input) as any as { promise: Promise<subt>, loaded: boolean, raw: subt } & subt;\r\n}\r\n\r\nexport class ImageDataSet {\r\n\tbuffers: ImageData[] = [];\r\n\r\n\tmatchBest(img: ImageData, x: number, y: number, max?: number) {\r\n\t\tlet best: number | null = null;\r\n\t\tlet bestscore: number | undefined = max;\r\n\t\tfor (let a = 0; a < this.buffers.length; a++) {\r\n\t\t\tlet score = img.pixelCompare(this.buffers[a], x, y, bestscore)\r\n\t\t\tif (isFinite(score) && (bestscore == undefined || score < bestscore)) {\r\n\t\t\t\tbestscore = score;\r\n\t\t\t\tbest = a;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (best == null) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn { index: best, score: bestscore };\r\n\t}\r\n\r\n\r\n\tstatic fromFilmStrip(baseimg: ImageData, width: number) {\r\n\t\tif ((baseimg.width % width) != 0) { throw new Error(\"slice size does not fit in base img\"); }\r\n\t\tlet r = new ImageDataSet();\r\n\t\tfor (let x = 0; x < baseimg.width; x += width) {\r\n\t\t\tr.buffers.push(baseimg.clone(new Rect(x, 0, width, baseimg.height)));\r\n\t\t}\r\n\t\treturn r;\r\n\t}\r\n\r\n\tstatic fromFilmStripUneven(baseimg: ImageData, widths: number[]) {\r\n\t\tlet r = new ImageDataSet()\r\n\t\tlet x = 0;\r\n\t\tfor (let w of widths) {\r\n\t\t\tr.buffers.push(baseimg.clone(new Rect(x, 0, w, baseimg.height)));\r\n\t\t\tx += w;\r\n\t\t\tif (x > baseimg.width) { throw new Error(\"sampling filmstrip outside bounds\"); }\r\n\t\t}\r\n\t\tif (x != baseimg.width) { throw new Error(\"unconsumed pixels left in film strip imagedata\"); }\r\n\t\treturn r;\r\n\t}\r\n\r\n\tstatic fromAtlas(baseimg: ImageData, slices: RectLike[]) {\r\n\t\tlet r = new ImageDataSet();\r\n\t\tfor (let slice of slices) {\r\n\t\t\tr.buffers.push(baseimg.clone(slice));\r\n\t\t}\r\n\t\treturn r;\r\n\t}\r\n}","import { ImgRefCtx } from \"./index\";\r\nimport * as ImageDetect from \"./imagedetect\";\r\nimport { ImgRef } from \"./imgref\";\r\n\r\n\r\ntype ImgCallback = (imgref: ImgRef) => any;\r\ntype ErrorCallback = (text: string, id: string) => any;\r\nvar listeners: { cb: ImgCallback, error: ErrorCallback | undefined }[] = [];\r\nvar started = false;\r\nvar dndStarted = false;\r\nvar pasting = false;\r\nexport var lastref: ImgRef | null = null;\r\n\r\nexport function listen(func: ImgCallback, errorfunc?: ErrorCallback, dragndrop?: boolean) {\r\n\tlisteners.push({ cb: func, error: errorfunc });\r\n\r\n\tif (!started) { start(); }\r\n\tif (dragndrop && !dndStarted) { startDragNDrop(); }\r\n}\r\n\r\nexport function unlisten(func: ImgCallback) {\r\n\tlet i = listeners.findIndex(c => c.cb == func);\r\n\tif (i != -1) {\r\n\t\tlisteners.splice(i, 1);\r\n\t}\r\n}\r\n\r\n/**\r\n * currently used in multiple document situations (iframe), might be removed in the future\r\n */\r\nexport function triggerPaste(img: ImgRef) {\r\n\tlastref = img;\r\n\tfor (var a in listeners) { listeners[a].cb(lastref); }\r\n}\r\n\r\nfunction pasted(img: HTMLImageElement | HTMLCanvasElement) {\r\n\tpasting = false;\r\n\tlet cnv = img instanceof HTMLCanvasElement ? img : img.toCanvas();\r\n\ttriggerPaste(new ImgRefCtx(cnv));\r\n}\r\n\r\nfunction error(mes: string, error: string) {\r\n\tpasting = false;\r\n\tfor (var a in listeners) {\r\n\t\tlisteners[a].error?.(mes, error);\r\n\t}\r\n}\r\n\r\nexport function startDragNDrop() {\r\n\tvar getitem = function (items: DataTransferItemList) {\r\n\t\tvar foundimage = \"\";\r\n\t\tfor (var a = 0; a < items.length; a++) {\r\n\t\t\tvar item = items[a];\r\n\t\t\tvar m = item.type.match(/^image\\/(\\w+)$/)\r\n\t\t\tif (m) {\r\n\t\t\t\tif (m[1] == \"png\") { return item; }\r\n\t\t\t\telse { foundimage = m[1]; }\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (foundimage) {\r\n\t\t\terror(\"The image you uploaded is not a .png image. Other image type have compression noise and can't be used for image detection.\", \"notpng\");\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\twindow.addEventListener(\"dragover\", function (e) {\r\n\t\te.preventDefault();\r\n\t});\r\n\twindow.addEventListener(\"drop\", function (e) {\r\n\t\tif (!e.dataTransfer) { return; }\r\n\t\tvar item = getitem(e.dataTransfer.items);\r\n\t\te.preventDefault();\r\n\t\tif (!item) { return; }\r\n\t\tfromFile(item.getAsFile());\r\n\t});\r\n}\r\n\r\nexport function start() {\r\n\tif (started) { return; }\r\n\tstarted = true;\r\n\r\n\t//determine if we have a clipboard api\r\n\t//try{a=new Event(\"clipboard\"); a=\"clipboardData\" in a;}\r\n\t//catch(e){a=false;}\r\n\tvar ischrome = !!navigator.userAgent.match(/Chrome/) && !navigator.userAgent.match(/Edge/);\r\n\t//old method breaks after chrome 41, revert to good old user agent sniffing\r\n\t//nvm, internet explorer (edge) decided that it wants to be chrome, however fails at delivering\r\n\r\n\t//turns out this one is interesting, edge is a hybrid between the paste api's\r\n\tvar apipasted = function (e: ClipboardEvent) {\r\n\t\tif (!e.clipboardData) { return; }\r\n\r\n\t\t//loop all data types\r\n\t\tfor (var a = 0; a < e.clipboardData.items.length; a++) {\r\n\t\t\tif (e.clipboardData.items[a].type.indexOf(\"image\") != -1) {\r\n\t\t\t\tfromFile(e.clipboardData.items[a].getAsFile());\r\n\t\t\t\t// var img = new Image();\r\n\t\t\t\t// img.src = (window.URL || (window as any).webkitURL).createObjectURL(file);\r\n\t\t\t\t// if (img.width > 0) { pasted(img); }\r\n\t\t\t\t// else { img.onload = function () { pasted(img); } }\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tif (ischrome) {\r\n\t\tdocument.addEventListener(\"paste\", apipasted);\r\n\t}\r\n\telse {\r\n\t\tvar catcher = document.createElement(\"div\");\r\n\t\tcatcher.setAttribute(\"contenteditable\", \"\");\r\n\t\tcatcher.className = \"forcehidden\";//retarded ie safety/bug, cant apply styles using js//TODO i don't even know what's going on\r\n\t\tcatcher.onpaste = function (e) {\r\n\t\t\tif (e.clipboardData && e.clipboardData.items) { apipasted(e); return; }\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tvar b = catcher.children[0] as HTMLImageElement\r\n\t\t\t\tif (!b || b.tagName != \"IMG\") { return; }\r\n\t\t\t\tvar img = new Image();\r\n\t\t\t\timg.src = b.src;\r\n\t\t\t\tvar a = img.src.match(/^data:([\\w\\/]+);/);\r\n\t\t\t\tif (img.width > 0) { pasted(img); }\r\n\t\t\t\telse { img.onload = function () { pasted(img) }; }\r\n\t\t\t\tcatcher.innerHTML = \"\";\r\n\t\t\t}, 1);\r\n\t\t};\r\n\t\tdocument.body.appendChild(catcher);\r\n\t}\r\n\r\n\t//detect if ctrl-v is pressed and focus catcher if needed\r\n\tdocument.addEventListener(\"keydown\", function (e) {\r\n\t\tif ((e.target as HTMLElement).tagName == \"INPUT\") { return; }\r\n\t\tif (e.keyCode != \"V\".charCodeAt(0) || !e.ctrlKey) { return; }\r\n\t\tpasting = true;\r\n\t\tsetTimeout(function () {\r\n\t\t\tif (pasting) { error(\"You pressed Ctrl+V, but no image was pasted by your browser, make sure your clipboard contains an image, and not a link to an image.\", \"noimg\"); }\r\n\t\t}, 1000);\r\n\t\tif (catcher) { catcher.focus(); }\r\n\t});\r\n}\r\n\r\nexport function fileDialog() {\r\n\tvar fileinput = document.createElement(\"input\");\r\n\tfileinput.type = \"file\";\r\n\tfileinput.accept = \"image/png\";\r\n\tfileinput.onchange = function () { if (fileinput.files && fileinput.files[0]) { fromFile(fileinput.files[0]); } };\r\n\tfileinput.click();\r\n\treturn fileinput;\r\n}\r\n\r\nfunction fromFile(file: File | null) {\r\n\tif (!file) { return; }\r\n\tvar reader = new FileReader();\r\n\treader.onload = function () {//TODO check if it's actually png\r\n\t\tvar bytearray = new Uint8Array(reader.result as ArrayBuffer);\r\n\t\tif (ImageDetect.isPngBuffer(bytearray)) {\r\n\t\t\tImageDetect.clearPngColorspace(bytearray);\r\n\t\t}\r\n\t\tvar blob = new Blob([bytearray], { type: \"image/png\" });\r\n\t\tvar img = new Image();\r\n\t\timg.onerror = () => error(\"The file you uploaded could not be opened as an image.\", \"invalidfile\");\r\n\t\tvar bloburl = URL.createObjectURL(blob);\r\n\t\timg.src = bloburl;\r\n\t\tif (img.width > 0) { pasted(img); URL.revokeObjectURL(bloburl); }\r\n\t\telse { img.onload = function () { pasted(img); URL.revokeObjectURL(bloburl); }; }\r\n\t};\r\n\r\n\treader.readAsArrayBuffer(file);\r\n}","\r\n\r\nimport \"./declarations\";\r\n\r\nimport * as ImageDetect from \"./imagedetect\";\r\nimport * as PasteInput from \"./pasteinput\";\r\nimport Rect, { RectLike, PointLike } from \"./rect\";\r\nimport { ImageData } from \"./imagedata-extensions\";\r\n\r\nexport { PasteInput, ImageDetect, Rect, RectLike, ImageData, PointLike };\r\nexport * from \"./imgref\";\r\nexport * from \"./wrapper\";\r\n\r\n\r\n// // syntax not yet supported in webpack\r\n// // this should improve tree shaking\r\n// import \"./declarations\";\r\n\r\n// export * as ImageDetect from \"./imagedetect\";\r\n// export * as PasteInput from \"./pasteinput\";\r\n// export { default as Rect, RectLike, PointLike } from \"./rect\";\r\n// export { ImageData } from \"./imagedata-extensions\";\r\n\r\n// export * from \"./imgref\";\r\n// export * from \"./wrapper\";\r\n\r\n"],"sourceRoot":""}